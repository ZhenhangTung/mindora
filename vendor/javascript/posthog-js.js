function e(f,p){var v=Object.keys(f);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(f);p&&(_=_.filter((function(p){return Object.getOwnPropertyDescriptor(f,p).enumerable}))),v.push.apply(v,_)}return v}function t(f){for(var p=1;p<arguments.length;p++){var v=null!=arguments[p]?arguments[p]:{};p%2?e(Object(v),!0).forEach((function(p){o(f,p,v[p])})):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(v)):e(Object(v)).forEach((function(p){Object.defineProperty(f,p,Object.getOwnPropertyDescriptor(v,p))}))}return f}function n(f){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"==typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},n(f)}function i(f,p){if(!(f instanceof p))throw new TypeError("Cannot call a class as a function")}function r(f,p){for(var v=0;v<p.length;v++){var _=p[v];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(f,_.key,_)}}function s(f,p,v){return p&&r(f.prototype,p),v&&r(f,v),Object.defineProperty(f,"prototype",{writable:!1}),f}function o(f,p,v){return p in f?Object.defineProperty(f,p,{value:v,enumerable:!0,configurable:!0,writable:!0}):f[p]=v,f}function a(f,p){if(null==f)return{};var v,_,g=function(f,p){if(null==f)return{};var v,_,g={},m=Object.keys(f);for(_=0;_<m.length;_++)v=m[_],p.indexOf(v)>=0||(g[v]=f[v]);return g}(f,p);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(f);for(_=0;_<m.length;_++)v=m[_],p.indexOf(v)>=0||Object.prototype.propertyIsEnumerable.call(f,v)&&(g[v]=f[v])}return g}function u(f,p){return function(f){if(Array.isArray(f))return f}(f)||function(f,p){var v=null==f?null:"undefined"!=typeof Symbol&&f[Symbol.iterator]||f["@@iterator"];if(null!=v){var _,g,m=[],T=!0,C=!1;try{for(v=v.call(f);!(T=(_=v.next()).done)&&(m.push(_.value),!p||m.length!==p);T=!0);}catch(f){C=!0,g=f}finally{try{T||null==v.return||v.return()}finally{if(C)throw g}}return m}}(f,p)||c(f,p)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(f){return function(f){if(Array.isArray(f))return d(f)}(f)||function(f){if("undefined"!=typeof Symbol&&null!=f[Symbol.iterator]||null!=f["@@iterator"])return Array.from(f)}(f)||c(f)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(f,p){if(f){if("string"==typeof f)return d(f,p);var v=Object.prototype.toString.call(f).slice(8,-1);return"Object"===v&&f.constructor&&(v=f.constructor.name),"Map"===v||"Set"===v?Array.from(f):"Arguments"===v||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?d(f,p):void 0}}function d(f,p){(null==p||p>f.length)&&(p=f.length);for(var v=0,_=new Array(p);v<p;v++)_[v]=f[v];return _}function h(f,p){var v="undefined"!=typeof Symbol&&f[Symbol.iterator]||f["@@iterator"];if(!v){if(Array.isArray(f)||(v=c(f))||p&&f&&"number"==typeof f.length){v&&(f=v);var _=0,r=function(){};return{s:r,n:function(){return _>=f.length?{done:!0}:{done:!1,value:f[_++]}},e:function(f){throw f},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var g,m=!0,T=!1;return{s:function(){v=v.call(f)},n:function(){var f=v.next();return m=f.done,f},e:function(f){T=!0,g=f},f:function(){try{m||null==v.return||v.return()}finally{if(T)throw g}}}}var f={DEBUG:!1,LIB_VERSION:"1.148.0"},p=Array.isArray,v=Object.prototype,_=v.hasOwnProperty,g=v.toString,m=p||function(f){return"[object Array]"===g.call(f)},y=function(f){return"function"==typeof f},b=function(f){return f===Object(f)&&!m(f)},k=function(f){if(b(f)){for(var p in f)if(_.call(f,p))return!1;return!0}return!1},w=function(f){return void 0===f},S=function(f){return"[object String]"==g.call(f)},E=function(f){return S(f)&&0===f.trim().length},F=function(f){return null===f},I=function(f){return w(f)||F(f)},R=function(f){return"[object Number]"==g.call(f)},x=function(f){return"[object Boolean]"===g.call(f)},P=function(f){return f instanceof FormData},T="undefined"!=typeof window?window:void 0,C="undefined"!=typeof globalThis?globalThis:T,$=Array.prototype,O=$.forEach,M=$.indexOf,A=null==C?void 0:C.navigator,D=null==C?void 0:C.document,L=null==C?void 0:C.location,N=null==C?void 0:C.fetch,q=null!=C&&C.XMLHttpRequest&&"withCredentials"in new C.XMLHttpRequest?C.XMLHttpRequest:void 0,B=null==C?void 0:C.AbortController,H=null==A?void 0:A.userAgent,U=null!=T?T:{},j="[PostHog.js]",W={_log:function(p){if(T&&(f.DEBUG||U.POSTHOG_DEBUG)&&!w(T.console)&&T.console){for(var v=("__rrweb_original__"in T.console[p]?T.console[p].__rrweb_original__:T.console[p]),_=arguments.length,g=new Array(_>1?_-1:0),m=1;m<_;m++)g[m-1]=arguments[m];v.apply(void 0,[j].concat(g))}},info:function(){for(var f=arguments.length,p=new Array(f),v=0;v<f;v++)p[v]=arguments[v];W._log.apply(W,["log"].concat(p))},warn:function(){for(var f=arguments.length,p=new Array(f),v=0;v<f;v++)p[v]=arguments[v];W._log.apply(W,["warn"].concat(p))},error:function(){for(var f=arguments.length,p=new Array(f),v=0;v<f;v++)p[v]=arguments[v];W._log.apply(W,["error"].concat(p))},critical:function(){for(var f,p=arguments.length,v=new Array(p),_=0;_<p;_++)v[_]=arguments[_];(f=console).error.apply(f,[j].concat(v))},uninitializedWarning:function(f){W.error("You must initialize PostHog before calling ".concat(f))}},G={},z=function(f){return f.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function V(f,p,v){if(m(f))if(O&&f.forEach===O)f.forEach(p,v);else if("length"in f&&f.length===+f.length)for(var _=0,g=f.length;_<g;_++)if(_ in f&&p.call(v,f[_],_)===G)return}function Q(f,p,v){if(!I(f)){if(m(f))return V(f,p,v);if(P(f)){var g,T=h(f.entries());try{for(T.s();!(g=T.n()).done;){var C=g.value;if(p.call(v,C[1],C[0])===G)return}}catch(f){T.e(f)}finally{T.f()}}else for(var $ in f)if(_.call(f,$)&&p.call(v,f[$],$)===G)return}}var J=function(f){for(var p=arguments.length,v=new Array(p>1?p-1:0),_=1;_<p;_++)v[_-1]=arguments[_];return V(v,(function(p){for(var v in p)void 0!==p[v]&&(f[v]=p[v])})),f};function Y(f,p){return-1!==f.indexOf(p)}function X(f){for(var p=Object.keys(f),v=p.length,_=new Array(v);v--;)_[v]=[p[v],f[p[v]]];return _}var K=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},Z=function(f){try{return f()}catch(f){return}},ee=function(f){return function(){try{for(var p=arguments.length,v=new Array(p),_=0;_<p;_++)v[_]=arguments[_];return f.apply(this,v)}catch(f){W.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),W.critical(f)}}},te=function(f){var p={};return Q(f,(function(f,v){S(f)&&f.length>0&&(p[v]=f)})),p},ne=function(f){return f.replace(/^\$/,"")};function ie(f,p){return v=f,_=function(f){return S(f)&&!F(p)?f.slice(0,p):f},g=new Set,function e(f,p){return f!==Object(f)?_?_(f,p):f:g.has(f)?void 0:(g.add(f),m(f)?(v=[],V(f,(function(f){v.push(e(f))}))):(v={},Q(f,(function(f,p){g.has(f)||(v[p]=e(f,p))}))),v);var v}(v);var v,_,g}var re,se=function(f){var p,v,_,g,m="";for(p=v=0,_=(f=(f+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,g=0;g<_;g++){var T=f.charCodeAt(g),C=null;T<128?v++:C=T>127&&T<2048?String.fromCharCode(T>>6|192,63&T|128):String.fromCharCode(T>>12|224,T>>6&63|128,63&T|128),F(C)||(v>p&&(m+=f.substring(p,v)),m+=C,p=v=g+1)}return v>p&&(m+=f.substring(p,f.length)),m},oe=function(){function e(f){return f&&(f.preventDefault=e.preventDefault,f.stopPropagation=e.stopPropagation),f}return e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0},function(f,p,v,_,g){if(f)if(f.addEventListener&&!_)f.addEventListener(p,v,!!g);else{var m="on"+p,C=f[m];f[m]=function(f,p,v){return function(_){if(_=_||e(null==T?void 0:T.event)){var g,m=!0;y(v)&&(g=v(_));var C=p.call(f,_);return!1!==g&&!1!==C||(m=!1),m}}}(f,v,C)}else W.error("No valid element provided to register_event")}}();function ae(f,p){for(var v=0;v<f.length;v++)if(p(f[v]))return f[v]}!function(f){f.GZipJS="gzip-js",f.Base64="base64"}(re||(re={}));var ue=["fatal","error","warning","log","info","debug"],le="$people_distinct_id",ce="__alias",de="__timers",he="$autocapture_disabled_server_side",fe="$heatmaps_enabled_server_side",pe="$exception_capture_enabled_server_side",ve="$exception_capture_endpoint",_e="$web_vitals_enabled_server_side",ge="$session_recording_enabled_server_side",me="$console_log_recording_enabled_server_side",ye="$session_recording_network_payload_capture",be="$session_recording_canvas_recording",ke="$replay_sample_rate",we="$replay_minimum_duration",Se="$sesid",Ee="$session_is_sampled",Fe="$enabled_feature_flags",Ie="$early_access_features",Re="$stored_person_properties",xe="$stored_group_properties",Pe="$surveys",Te="$surveys_activated",Ce="$flag_call_reported",$e="$user_state",Oe="$client_session_props",Me="$capture_rate_limit",Ae="$initial_campaign_params",De="$initial_referrer_info",Le="$initial_person_info",Ne="$epp",qe="__POSTHOG_TOOLBAR__",Be=[le,ce,"__cmpns",de,ge,fe,Se,Fe,$e,Ie,xe,Re,Pe,Ce,Oe,Me,Ae,De,Ne],He="$active_feature_flags",Ue="$override_feature_flags",je="$feature_flag_payloads",We=function(f){var p,v={},_=h(X(f||{}));try{for(_.s();!(p=_.n()).done;){var g=u(p.value,2),m=g[0],T=g[1];T&&(v[m]=T)}}catch(f){_.e(f)}finally{_.f()}return v},Ge=function(){function e(f){i(this,e),this.instance=f,this._override_warning=!1,this.featureFlagEventHandlers=[],this.reloadFeatureFlagsQueued=!1,this.reloadFeatureFlagsInAction=!1}return s(e,[{key:"getFlags",value:function(){return Object.keys(this.getFlagVariants())}},{key:"getFlagVariants",value:function(){var f=this.instance.get_property(Fe),p=this.instance.get_property(Ue);if(!p)return f||{};for(var v=J({},f),_=Object.keys(p),g=0;g<_.length;g++)v[_[g]]=p[_[g]];return this._override_warning||(W.warn(" Overriding feature flags!",{enabledFlags:f,overriddenFlags:p,finalFlags:v}),this._override_warning=!0),v}},{key:"getFlagPayloads",value:function(){return this.instance.get_property(je)||{}}},{key:"reloadFeatureFlags",value:function(){this.reloadFeatureFlagsQueued||(this.reloadFeatureFlagsQueued=!0,this._startReloadTimer())}},{key:"setAnonymousDistinctId",value:function(f){this.$anon_distinct_id=f}},{key:"setReloadingPaused",value:function(f){this.reloadFeatureFlagsInAction=f}},{key:"resetRequestQueue",value:function(){this.reloadFeatureFlagsQueued=!1}},{key:"_startReloadTimer",value:function(){var f=this;this.reloadFeatureFlagsQueued&&!this.reloadFeatureFlagsInAction&&setTimeout((function(){!f.reloadFeatureFlagsInAction&&f.reloadFeatureFlagsQueued&&(f.reloadFeatureFlagsQueued=!1,f._reloadFeatureFlagsRequest())}),5)}},{key:"_reloadFeatureFlagsRequest",value:function(){var f=this;if(!this.instance.config.advanced_disable_feature_flags){this.setReloadingPaused(!0);var p=this.instance.config.token,v=this.instance.get_property(Re),_=this.instance.get_property(xe),g={token:p,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:v,group_properties:_,disable_flags:this.instance.config.advanced_disable_feature_flags||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:g,compression:this.instance.config.disable_compression?void 0:re.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(p){var v;f.setReloadingPaused(!1);var _=!0;200===p.statusCode&&(f.$anon_distinct_id=void 0,_=!1),f.receivedFeatureFlags(null!==(v=p.json)&&void 0!==v?v:{},_),f._startReloadTimer()}})}}},{key:"getFeatureFlag",value:function(f){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0){var v,_=this.getFlagVariants()[f],g="".concat(_),T=this.instance.get_property(Ce)||{};!p.send_event&&"send_event"in p||f in T&&T[f].includes(g)||(m(T[f])?T[f].push(g):T[f]=[g],null===(v=this.instance.persistence)||void 0===v||v.register(o({},Ce,T)),this.instance.capture("$feature_flag_called",{$feature_flag:f,$feature_flag_response:_}));return _}W.warn('getFeatureFlag for key "'+f+"\" failed. Feature flags didn't load in time.")}},{key:"getFeatureFlagPayload",value:function(f){return this.getFlagPayloads()[f]}},{key:"isFeatureEnabled",value:function(f){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(f,p);W.warn('isFeatureEnabled for key "'+f+"\" failed. Feature flags didn't load in time.")}},{key:"addFeatureFlagsHandler",value:function(f){this.featureFlagEventHandlers.push(f)}},{key:"removeFeatureFlagsHandler",value:function(f){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter((function(p){return p!==f}))}},{key:"receivedFeatureFlags",value:function(f,p){if(this.instance.persistence){this.instance.decideEndpointWasHit=!0;var v=this.getFlagVariants(),_=this.getFlagPayloads();!function(f,p){var v,_=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},T=f.featureFlags,C=f.featureFlagPayloads;if(T)if(m(T)){var $,O={};if(T)for(var M=0;M<T.length;M++)O[T[M]]=!0;p&&p.register((o($={},He,T),o($,Fe,O),$))}else{var A=T,D=C;f.errorsWhileComputingFlags&&(A=t(t({},_),A),D=t(t({},g),D)),p&&p.register((o(v={},He,Object.keys(We(A))),o(v,Fe,A||{}),o(v,je,D||{}),v))}}(f,this.instance.persistence,v,_),this._fireFeatureFlagsCallbacks(p)}}},{key:"override",value:function(f){if(!this.instance.__loaded||!this.instance.persistence)return W.uninitializedWarning("posthog.feature_flags.override");if(this._override_warning=!1,!1===f)this.instance.persistence.unregister(Ue);else if(m(f)){for(var p={},v=0;v<f.length;v++)p[f[v]]=!0;this.instance.persistence.register(o({},Ue,p))}else this.instance.persistence.register(o({},Ue,f))}},{key:"onFeatureFlags",value:function(f){var p=this;if(this.addFeatureFlagsHandler(f),this.instance.decideEndpointWasHit){var v=this._prepareFeatureFlagsForCallbacks(),_=v.flags,g=v.flagVariants;f(_,g)}return function(){return p.removeFeatureFlagsHandler(f)}}},{key:"updateEarlyAccessFeatureEnrollment",value:function(f,p){var v,_,g=o({},"$feature_enrollment/".concat(f),p);this.instance.capture("$feature_enrollment_update",{$feature_flag:f,$feature_enrollment:p,$set:g}),this.setPersonPropertiesForFlags(g,!1);var m=t(t({},this.getFlagVariants()),{},o({},f,p));null===(v=this.instance.persistence)||void 0===v||v.register((o(_={},He,Object.keys(We(m))),o(_,Fe,m),_)),this._fireFeatureFlagsCallbacks()}},{key:"getEarlyAccessFeatures",value:function(f){var p=this,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1],_=this.instance.get_property(Ie);if(_&&!v)return f(_);this.instance._send_request({transport:"XHR",url:this.instance.requestRouter.endpointFor("api","/api/early_access_features/?token=".concat(this.instance.config.token)),method:"GET",callback:function(v){var _;if(v.json){var g=v.json.earlyAccessFeatures;return null===(_=p.instance.persistence)||void 0===_||_.register(o({},Ie,g)),f(g)}}})}},{key:"_prepareFeatureFlagsForCallbacks",value:function(){var f=this.getFlags(),p=this.getFlagVariants();return{flags:f.filter((function(f){return p[f]})),flagVariants:Object.keys(p).filter((function(f){return p[f]})).reduce((function(f,v){return f[v]=p[v],f}),{})}}},{key:"_fireFeatureFlagsCallbacks",value:function(f){var p=this._prepareFeatureFlagsForCallbacks(),v=p.flags,_=p.flagVariants;this.featureFlagEventHandlers.forEach((function(p){return p(v,_,{errorsLoading:f})}))}},{key:"setPersonPropertiesForFlags",value:function(f){var p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=this.instance.get_property(Re)||{};this.instance.register(o({},Re,t(t({},v),f))),p&&this.instance.reloadFeatureFlags()}},{key:"resetPersonPropertiesForFlags",value:function(){this.instance.unregister(Re)}},{key:"setGroupPropertiesForFlags",value:function(f){var p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],v=this.instance.get_property(xe)||{};0!==Object.keys(v).length&&Object.keys(v).forEach((function(p){v[p]=t(t({},v[p]),f[p]),delete f[p]})),this.instance.register(o({},xe,t(t({},v),f))),p&&this.instance.reloadFeatureFlags()}},{key:"resetGroupPropertiesForFlags",value:function(f){if(f){var p=this.instance.get_property(xe)||{};this.instance.register(o({},xe,t(t({},p),{},o({},f,{}))))}else this.instance.unregister(xe)}}]),e}();Math.trunc||(Math.trunc=function(f){return f<0?Math.ceil(f):Math.floor(f)}),Number.isInteger||(Number.isInteger=function(f){return R(f)&&isFinite(f)&&Math.floor(f)===f});var Ve="0123456789abcdef",ze=function(){function e(f){if(i(this,e),this.bytes=f,16!==f.length)throw new TypeError("not 128-bit length")}return s(e,[{key:"toString",value:function(){for(var f="",p=0;p<this.bytes.length;p++)f=f+Ve.charAt(this.bytes[p]>>>4)+Ve.charAt(15&this.bytes[p]),3!==p&&5!==p&&7!==p&&9!==p||(f+="-");if(36!==f.length)throw new Error("Invalid UUIDv7 was generated");return f}},{key:"clone",value:function(){return new e(this.bytes.slice(0))}},{key:"equals",value:function(f){return 0===this.compareTo(f)}},{key:"compareTo",value:function(f){for(var p=0;p<16;p++){var v=this.bytes[p]-f.bytes[p];if(0!==v)return Math.sign(v)}return 0}}],[{key:"fromFieldsV7",value:function(f,p,v,_){if(!Number.isInteger(f)||!Number.isInteger(p)||!Number.isInteger(v)||!Number.isInteger(_)||f<0||p<0||v<0||_<0||f>0xffffffffffff||p>4095||v>1073741823||_>4294967295)throw new RangeError("invalid field value");var g=new Uint8Array(16);return g[0]=f/Math.pow(2,40),g[1]=f/Math.pow(2,32),g[2]=f/Math.pow(2,24),g[3]=f/Math.pow(2,16),g[4]=f/Math.pow(2,8),g[5]=f,g[6]=112|p>>>8,g[7]=p,g[8]=128|v>>>24,g[9]=v>>>16,g[10]=v>>>8,g[11]=v,g[12]=_>>>24,g[13]=_>>>16,g[14]=_>>>8,g[15]=_,new e(g)}}]),e}(),Ye=function(){function e(){i(this,e),o(this,"timestamp",0),o(this,"counter",0),o(this,"random",new Xe)}return s(e,[{key:"generate",value:function(){var f=this.generateOrAbort();if(w(f)){this.timestamp=0;var p=this.generateOrAbort();if(w(p))throw new Error("Could not generate UUID after timestamp reset");return p}return f}},{key:"generateOrAbort",value:function(){var f=Date.now();if(f>this.timestamp)this.timestamp=f,this.resetCounter();else{if(!(f+1e4>this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return ze.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}}]),e}(),Je=function(f){if("undefined"!=typeof UUIDV7_DENY_WEAK_RNG&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var p=0;p<f.length;p++)f[p]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return f};T&&!w(T.crypto)&&crypto.getRandomValues&&(Je=function(f){return crypto.getRandomValues(f)});var Qe,Xe=function(){function e(){i(this,e),o(this,"buffer",new Uint32Array(8)),o(this,"cursor",1/0)}return s(e,[{key:"nextUint32",value:function(){return this.cursor>=this.buffer.length&&(Je(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}]),e}(),Ke=function(){return Ze().toString()},Ze=function(){return(Qe||(Qe=new Ye)).generate()},et="Thu, 01 Jan 1970 00:00:00 GMT",tt="";var nt=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function it(f,p){if(p){var v=function(f){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D;if(tt)return tt;if(!p)return"";if(["localhost","127.0.0.1"].includes(f))return"";for(var v=f.split("."),_=Math.min(v.length,8),g="dmn_chk_"+Ke(),m=new RegExp("(^|;)\\s*"+g+"=1");!tt&&_--;){var T=v.slice(_).join("."),C=g+"=1;domain=."+T;p.cookie=C,m.test(p.cookie)&&(p.cookie=C+";expires="+et,tt=T)}return tt}(f);if(!v){var _=function(f){var p=f.match(nt);return p?p[0]:""}(f);_!==v&&W.info("Warning: cookie subdomain discovery mismatch",_,v),v=_}return v?"; domain=."+v:""}return""}var rt,st={is_supported:function(){return!!D},error:function(f){W.error("cookieStore error: "+f)},get:function(f){if(D){try{for(var p=f+"=",v=D.cookie.split(";").filter((function(f){return f.length})),_=0;_<v.length;_++){for(var g=v[_];" "==g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(p))return decodeURIComponent(g.substring(p.length,g.length))}}catch(f){}return null}},parse:function(f){var p;try{p=JSON.parse(st.get(f))||{}}catch(f){}return p},set:function(f,p,v,_,g){if(D)try{var m="",T="",C=it(D.location.hostname,_);if(v){var $=new Date;$.setTime($.getTime()+24*v*60*60*1e3),m="; expires="+$.toUTCString()}g&&(T="; secure");var O=f+"="+encodeURIComponent(JSON.stringify(p))+m+"; SameSite=Lax; path=/"+C+T;return O.length>3686.4&&W.warn("cookieStore warning: large cookie, len="+O.length),D.cookie=O,O}catch(f){return}},remove:function(f,p){try{st.set(f,"",-1,p)}catch(f){return}}},ot=null,at={is_supported:function(){if(!F(ot))return ot;var f=!0;if(w(T))f=!1;else try{var p="__mplssupport__";at.set(p,"xyz"),'"xyz"'!==at.get(p)&&(f=!1),at.remove(p)}catch(p){f=!1}return f||W.error("localStorage unsupported; falling back to cookie store"),ot=f,f},error:function(f){W.error("localStorage error: "+f)},get:function(f){try{return null==T?void 0:T.localStorage.getItem(f)}catch(f){at.error(f)}return null},parse:function(f){try{return JSON.parse(at.get(f))||{}}catch(f){}return null},set:function(f,p){try{null==T||T.localStorage.setItem(f,JSON.stringify(p))}catch(f){at.error(f)}},remove:function(f){try{null==T||T.localStorage.removeItem(f)}catch(f){at.error(f)}}},ut=["distinct_id",Se,Ee,Ne],lt=t(t({},at),{},{parse:function(f){try{var p={};try{p=st.parse(f)||{}}catch(f){}var v=J(p,JSON.parse(at.get(f)||"{}"));return at.set(f,v),v}catch(f){}return null},set:function(f,p,v,_,g){try{at.set(f,p);var m={};ut.forEach((function(f){p[f]&&(m[f]=p[f])})),Object.keys(m).length&&st.set(f,m,v,_,g)}catch(f){at.error(f)}},remove:function(f,p){try{null==T||T.localStorage.removeItem(f),st.remove(f,p)}catch(f){at.error(f)}}}),ct={},dt={is_supported:function(){return!0},error:function(f){W.error("memoryStorage error: "+f)},get:function(f){return ct[f]||null},parse:function(f){return ct[f]||null},set:function(f,p){ct[f]=p},remove:function(f){delete ct[f]}},ht=null,ft={is_supported:function(){if(!F(ht))return ht;if(ht=!0,w(T))ht=!1;else try{var f="__support__";ft.set(f,"xyz"),'"xyz"'!==ft.get(f)&&(ht=!1),ft.remove(f)}catch(f){ht=!1}return ht},error:function(f){W.error("sessionStorage error: ",f)},get:function(f){try{return null==T?void 0:T.sessionStorage.getItem(f)}catch(f){ft.error(f)}return null},parse:function(f){try{return JSON.parse(ft.get(f))||null}catch(f){}return null},set:function(f,p){try{null==T||T.sessionStorage.setItem(f,JSON.stringify(p))}catch(f){ft.error(f)}},remove:function(f){try{null==T||T.sessionStorage.removeItem(f)}catch(f){ft.error(f)}}},pt=["localhost","127.0.0.1"],vt=function(f){var p=null==D?void 0:D.createElement("a");return w(p)?null:(p.href=f,p)},_t=function(f,p){return!!function(f){try{new RegExp(f)}catch(f){return!1}return!0}(p)&&new RegExp(p).test(f)},gt=function(f){var p,v,_=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",g=[];return Q(f,(function(f,_){w(f)||w(_)||"undefined"===_||(p=encodeURIComponent(function(f){return f instanceof File}(f)?f.name:f.toString()),v=encodeURIComponent(_),g[g.length]=v+"="+p)})),g.join(_)},mt=function(f,p){for(var v,_=((f.split("#")[0]||"").split("?")[1]||"").split("&"),g=0;g<_.length;g++){var T=_[g].split("=");if(T[0]===p){v=T;break}}if(!m(v)||v.length<2)return"";var C=v[1];try{C=decodeURIComponent(C)}catch(f){W.error("Skipping decoding for malformed query param: "+C)}return C.replace(/\+/g," ")},yt=function(f,p){var v=f.match(new RegExp(p+"=([^&]*)"));return v?v[1]:null},bt="Mobile",kt="iOS",wt="Android",St="Tablet",Et=wt+" "+St,Ft="iPad",It="Apple",Rt=It+" Watch",xt="Safari",Pt="BlackBerry",Tt="Samsung",Ct=Tt+"Browser",$t=Tt+" Internet",Ot="Chrome",Mt=Ot+" OS",At=Ot+" "+kt,Dt="Internet Explorer",Lt=Dt+" "+bt,Nt="Opera",qt=Nt+" Mini",Bt="Edge",Ht="Microsoft "+Bt,Ut="Firefox",jt=Ut+" "+kt,Wt="Nintendo",Gt="PlayStation",Vt="Xbox",zt=wt+" "+bt,Yt=bt+" "+xt,Qt="Windows",Jt=Qt+" Phone",Xt="Nokia",Kt="Ouya",Zt="Generic",en=Zt+" "+bt.toLowerCase(),tn=Zt+" "+St.toLowerCase(),nn="Konqueror",rn="(\\d+(\\.\\d+)?)",sn=new RegExp("Version/"+rn),on=new RegExp(Vt,"i"),an=new RegExp(Gt+" \\w+","i"),un=new RegExp(Wt+" \\w+","i"),ln=new RegExp(Pt+"|PlayBook|BB10","i"),cn={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"};var dn=function(f,p){return p&&Y(p,It)||function(f){return Y(f,xt)&&!Y(f,Ot)&&!Y(f,wt)}(f)},hn=function(f,p){return p=p||"",Y(f," OPR/")&&Y(f,"Mini")?qt:Y(f," OPR/")?Nt:ln.test(f)?Pt:Y(f,"IE"+bt)||Y(f,"WPDesktop")?Lt:Y(f,Ct)?$t:Y(f,Bt)||Y(f,"Edg/")?Ht:Y(f,"FBIOS")?"Facebook "+bt:Y(f,"UCWEB")||Y(f,"UCBrowser")?"UC Browser":Y(f,"CriOS")?At:Y(f,"CrMo")?Ot:Y(f,wt)&&Y(f,xt)?zt:Y(f,Ot)?Ot:Y(f,"FxiOS")?jt:Y(f.toLowerCase(),nn.toLowerCase())?nn:dn(f,p)?Y(f,bt)?Yt:xt:Y(f,Ut)?Ut:Y(f,"MSIE")||Y(f,"Trident/")?Dt:Y(f,"Gecko")?Ut:""},fn=(o(rt={},Lt,[new RegExp("rv:"+rn)]),o(rt,Ht,[new RegExp(Bt+"?\\/"+rn)]),o(rt,Ot,[new RegExp("("+Ot+"|CrMo)\\/"+rn)]),o(rt,At,[new RegExp("CriOS\\/"+rn)]),o(rt,"UC Browser",[new RegExp("(UCBrowser|UCWEB)\\/"+rn)]),o(rt,xt,[sn]),o(rt,Yt,[sn]),o(rt,Nt,[new RegExp("(Opera|OPR)\\/"+rn)]),o(rt,Ut,[new RegExp(Ut+"\\/"+rn)]),o(rt,jt,[new RegExp("FxiOS\\/"+rn)]),o(rt,nn,[new RegExp("Konqueror[:/]?"+rn,"i")]),o(rt,Pt,[new RegExp(Pt+" "+rn),sn]),o(rt,zt,[new RegExp("android\\s"+rn,"i")]),o(rt,$t,[new RegExp(Ct+"\\/"+rn)]),o(rt,Dt,[new RegExp("(rv:|MSIE )"+rn)]),o(rt,"Mozilla",[new RegExp("rv:"+rn)]),rt),pn=[[new RegExp(Vt+"; "+Vt+" (.*?)[);]","i"),function(f){return[Vt,f&&f[1]||""]}],[new RegExp(Wt,"i"),[Wt,""]],[new RegExp(Gt,"i"),[Gt,""]],[ln,[Pt,""]],[new RegExp(Qt,"i"),function(f,p){if(/Phone/.test(p)||/WPDesktop/.test(p))return[Jt,""];if(new RegExp(bt).test(p)&&!/IEMobile\b/.test(p))return[Qt+" "+bt,""];var v=/Windows NT ([0-9.]+)/i.exec(p);if(v&&v[1]){var _=v[1],g=cn[_]||"";return/arm/i.test(p)&&(g="RT"),[Qt,g]}return[Qt,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,function(f){if(f&&f[3]){var p=[f[3],f[4],f[5]||"0"];return[kt,p.join(".")]}return[kt,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,function(f){var p="";return f&&f.length>=3&&(p=w(f[2])?f[3]:f[2]),["watchOS",p]}],[new RegExp("("+wt+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+wt+")","i"),function(f){if(f&&f[2]){var p=[f[2],f[3],f[4]||"0"];return[wt,p.join(".")]}return[wt,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,function(f){var p=["Mac OS X",""];if(f&&f[1]){var v=[f[1],f[2],f[3]||"0"];p[1]=v.join(".")}return p}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[Mt,""]],[/Linux|debian/i,["Linux",""]]],vn=function(f){return un.test(f)?Wt:an.test(f)?Gt:on.test(f)?Vt:new RegExp(Kt,"i").test(f)?Kt:new RegExp("("+Jt+"|WPDesktop)","i").test(f)?Jt:/iPad/.test(f)?Ft:/iPod/.test(f)?"iPod Touch":/iPhone/.test(f)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(f)?Rt:ln.test(f)?Pt:/(kobo)\s(ereader|touch)/i.test(f)?"Kobo":new RegExp(Xt,"i").test(f)?Xt:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(f)||/(kf[a-z]+)( bui|\)).+silk\//i.test(f)?"Kindle Fire":/(Android|ZTE)/i.test(f)?!new RegExp(bt).test(f)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(f)?/pixel[\daxl ]{1,6}/i.test(f)&&!/pixel c/i.test(f)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(f)||/lmy47v/i.test(f)&&!/QTAQZ3/i.test(f)?wt:Et:wt:new RegExp("(pda|"+bt+")","i").test(f)?en:new RegExp(St,"i").test(f)&&!new RegExp(St+" pc","i").test(f)?tn:""},_n="https?://(.*)",gn=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","gad_source","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","mc_cid","igshid","ttclid","rdt_cid"],mn={campaignParams:function(f){return D?this._campaignParamsFromUrl(D.URL,f):{}},_campaignParamsFromUrl:function(f,p){var v=gn.concat(p||[]),_={};return Q(v,(function(p){var v=mt(f,p);v&&(_[p]=v)})),_},_searchEngine:function(f){return f?0===f.search(_n+"google.([^/?]*)")?"google":0===f.search(_n+"bing.com")?"bing":0===f.search(_n+"yahoo.com")?"yahoo":0===f.search(_n+"duckduckgo.com")?"duckduckgo":null:null},_searchInfoFromReferrer:function(f){var p=mn._searchEngine(f),v="yahoo"!=p?"q":"p",_={};if(!F(p)){_.$search_engine=p;var g=D?mt(D.referrer,v):"";g.length&&(_.ph_keyword=g)}return _},searchInfo:function(){var f=null==D?void 0:D.referrer;return f?this._searchInfoFromReferrer(f):{}},browser:hn,browserVersion:function(f,p){var v=hn(f,p),_=fn[v];if(w(_))return null;for(var g=0;g<_.length;g++){var m=_[g],T=f.match(m);if(T)return parseFloat(T[T.length-2])}return null},browserLanguage:function(){return navigator.language||navigator.userLanguage},os:function(f){for(var p=0;p<pn.length;p++){var v=u(pn[p],2),_=v[0],g=v[1],m=_.exec(f),T=m&&(y(g)?g(m,f):g);if(T)return T}return["",""]},device:vn,deviceType:function(f){var p=vn(f);return p===Ft||p===Et||"Kobo"===p||"Kindle Fire"===p||p===tn?St:p===Wt||p===Vt||p===Gt||p===Kt?"Console":p===Rt?"Wearable":p?bt:"Desktop"},referrer:function(){return(null==D?void 0:D.referrer)||"$direct"},referringDomain:function(){var f;return null!=D&&D.referrer&&(null===(f=vt(D.referrer))||void 0===f?void 0:f.host)||"$direct"},referrerInfo:function(){return{$referrer:this.referrer(),$referring_domain:this.referringDomain()}},initialPersonInfo:function(){return{r:this.referrer(),u:null==L?void 0:L.href}},initialPersonPropsFromInfo:function(f){var p,v=f.r,_=f.u,g={$initial_referrer:v,$initial_referring_domain:null==v?void 0:"$direct"==v?"$direct":null===(p=vt(v))||void 0===p?void 0:p.host};if(_){g.$initial_current_url=_;var m=vt(_);g.$initial_host=null==m?void 0:m.host,g.$initial_pathname=null==m?void 0:m.pathname,Q(this._campaignParamsFromUrl(_),(function(f,p){g["$initial_"+ne(p)]=f}))}v&&Q(this._searchInfoFromReferrer(v),(function(f,p){g["$initial_"+ne(p)]=f}));return g},properties:function(){if(!H)return{};var p=u(mn.os(H),2),v=p[0],_=p[1];return J(te({$os:v,$os_version:_,$browser:mn.browser(H,navigator.vendor),$device:mn.device(H),$device_type:mn.deviceType(H)}),{$current_url:null==L?void 0:L.href,$host:null==L?void 0:L.host,$pathname:null==L?void 0:L.pathname,$raw_user_agent:H.length>1e3?H.substring(0,997)+"...":H,$browser_version:mn.browserVersion(H,navigator.vendor),$browser_language:mn.browserLanguage(),$screen_height:null==T?void 0:T.screen.height,$screen_width:null==T?void 0:T.screen.width,$viewport_height:null==T?void 0:T.innerHeight,$viewport_width:null==T?void 0:T.innerWidth,$lib:"web",$lib_version:f.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:K()/1e3})},people_properties:function(){if(!H)return{};var f=u(mn.os(H),2),p=f[0],v=f[1];return J(te({$os:p,$os_version:v,$browser:mn.browser(H,navigator.vendor)}),{$browser_version:mn.browserVersion(H,navigator.vendor)})}},yn=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"],bn=function(){function e(f){i(this,e),this.config=f,this.props={},this.campaign_params_saved=!1,this.name=function(f){var p="";return f.token&&(p=f.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),f.persistence_name?"ph_"+f.persistence_name:"ph_"+p+"_posthog"}(f),this.storage=this.buildStorage(f),this.load(),this.update_config(f,f),this.save()}return s(e,[{key:"buildStorage",value:function(f){-1===yn.indexOf(f.persistence.toLowerCase())&&(W.critical("Unknown persistence type "+f.persistence+"; falling back to localStorage+cookie"),f.persistence="localStorage+cookie");var p=f.persistence.toLowerCase();return"localstorage"===p&&at.is_supported()?at:"localstorage+cookie"===p&&lt.is_supported()?lt:"sessionstorage"===p&&ft.is_supported()?ft:"memory"===p?dt:"cookie"===p?st:lt.is_supported()?lt:st}},{key:"properties",value:function(){var f={};return Q(this.props,(function(p,v){if(v===Fe&&b(p))for(var _=Object.keys(p),g=0;g<_.length;g++)f["$feature/".concat(_[g])]=p[_[g]];else T=v,C=!1,(F(m=Be)?C:M&&m.indexOf===M?-1!=m.indexOf(T):(Q(m,(function(f){if(C||(C=f===T))return G})),C))||(f[v]=p);var m,T,C})),f}},{key:"load",value:function(){if(!this.disabled){var f=this.storage.parse(this.name);f&&(this.props=J({},f))}}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,this.props,this.expire_days,this.cross_subdomain,this.secure)}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"register_once",value:function(f,p,v){var _=this;if(b(f)){w(p)&&(p="None"),this.expire_days=w(v)?this.default_expiry:v;var g=!1;if(Q(f,(function(f,v){_.props.hasOwnProperty(v)&&_.props[v]!==p||(_.props[v]=f,g=!0)})),g)return this.save(),!0}return!1}},{key:"register",value:function(f,p){var v=this;if(b(f)){this.expire_days=w(p)?this.default_expiry:p;var _=!1;if(Q(f,(function(p,g){f.hasOwnProperty(g)&&v.props[g]!==p&&(v.props[g]=p,_=!0)})),_)return this.save(),!0}return!1}},{key:"unregister",value:function(f){f in this.props&&(delete this.props[f],this.save())}},{key:"update_campaign_params",value:function(){this.campaign_params_saved||(this.register(mn.campaignParams(this.config.custom_campaign_params)),this.campaign_params_saved=!0)}},{key:"update_search_keyword",value:function(){this.register(mn.searchInfo())}},{key:"update_referrer_info",value:function(){this.register(mn.referrerInfo())}},{key:"set_initial_person_info",value:function(){this.props[Ae]||this.props[De]||this.register_once(o({},Le,mn.initialPersonInfo()),void 0)}},{key:"get_referrer_info",value:function(){return te({$referrer:this.props.$referrer,$referring_domain:this.props.$referring_domain})}},{key:"get_initial_props",value:function(){var f=this,p={};Q([De,Ae],(function(v){var _=f.props[v];_&&Q(_,(function(f,v){p["$initial_"+ne(v)]=f}))}));var v=this.props[Le];if(v){var _=mn.initialPersonPropsFromInfo(v);J(p,_)}return p}},{key:"safe_merge",value:function(f){return Q(this.props,(function(p,v){v in f||(f[v]=p)})),f}},{key:"update_config",value:function(f,p){if(this.default_expiry=this.expire_days=f.cookie_expiration,this.set_disabled(f.disable_persistence),this.set_cross_subdomain(f.cross_subdomain_cookie),this.set_secure(f.secure_cookie),f.persistence!==p.persistence){var v=this.buildStorage(f),_=this.props;this.clear(),this.storage=v,this.props=_,this.save()}}},{key:"set_disabled",value:function(f){this.disabled=f,this.disabled?this.remove():this.save()}},{key:"set_cross_subdomain",value:function(f){f!==this.cross_subdomain&&(this.cross_subdomain=f,this.remove(),this.save())}},{key:"get_cross_subdomain",value:function(){return!!this.cross_subdomain}},{key:"set_secure",value:function(f){f!==this.secure&&(this.secure=f,this.remove(),this.save())}},{key:"set_event_timer",value:function(f,p){var v=this.props[de]||{};v[f]=p,this.props[de]=v,this.save()}},{key:"remove_event_timer",value:function(f){var p=(this.props[de]||{})[f];return w(p)||(delete this.props[de][f],this.save()),p}},{key:"get_property",value:function(f){return this.props[f]}},{key:"set_property",value:function(f,p){this.props[f]=p,this.save()}}]),e}();function kn(f){return JSON.stringify(f,(p=[],function(f,v){if(b(v)){for(;p.length>0&&p.at(-1)!==this;)p.pop();return p.includes(v)?"[Circular]":(p.push(v),v)}return v})).length;var p}var wn=2,Sn=4;function En(f){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6606028.8;if(f.size>=p&&f.data.length>1){var v=Math.floor(f.data.length/2),_=f.data.slice(0,v),g=f.data.slice(v);return[En({size:kn(_),data:_,sessionId:f.sessionId,windowId:f.windowId}),En({size:kn(g),data:g,sessionId:f.sessionId,windowId:f.windowId})].flatMap((function(f){return f}))}return[f]}var Fn=function(f){return f[f.DomContentLoaded=0]="DomContentLoaded",f[f.Load=1]="Load",f[f.FullSnapshot=2]="FullSnapshot",f[f.IncrementalSnapshot=3]="IncrementalSnapshot",f[f.Meta=4]="Meta",f[f.Custom=5]="Custom",f[f.Plugin=6]="Plugin",f}(Fn||{}),In=function(f){return f[f.Mutation=0]="Mutation",f[f.MouseMove=1]="MouseMove",f[f.MouseInteraction=2]="MouseInteraction",f[f.Scroll=3]="Scroll",f[f.ViewportResize=4]="ViewportResize",f[f.Input=5]="Input",f[f.TouchMove=6]="TouchMove",f[f.MediaInteraction=7]="MediaInteraction",f[f.StyleSheetRule=8]="StyleSheetRule",f[f.CanvasMutation=9]="CanvasMutation",f[f.Font=10]="Font",f[f.Log=11]="Log",f[f.Drag=12]="Drag",f[f.StyleDeclaration=13]="StyleDeclaration",f[f.Selection=14]="Selection",f[f.AdoptedStyleSheet=15]="AdoptedStyleSheet",f[f.CustomElement=16]="CustomElement",f}(In||{});function Rn(f){return f?z(f).split(/\s+/):[]}function xn(f){var p=null==T?void 0:T.location.href;return!!(p&&f&&f.some((function(f){return p.match(f)})))}function Pn(f){var p="";switch(n(f.className)){case"string":p=f.className;break;case"object":p=("baseVal"in f.className?f.className.baseVal:null)||f.getAttribute("class")||"";break;default:p=""}return Rn(p)}function Tn(f){return I(f)?null:z(f).split(/(\s+)/).filter((function(f){return Vn(f)})).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function Cn(f){var p="";return qn(f)&&!Bn(f)&&f.childNodes&&f.childNodes.length&&Q(f.childNodes,(function(f){var v;Mn(f)&&f.textContent&&(p+=null!==(v=Tn(f.textContent))&&void 0!==v?v:"")})),z(p)}function $n(f){return!!f&&1===f.nodeType}function On(f,p){return!!f&&!!f.tagName&&f.tagName.toLowerCase()===p.toLowerCase()}function Mn(f){return!!f&&3===f.nodeType}function An(f){return!!f&&11===f.nodeType}var Dn=["a","button","form","input","select","textarea","label"];function Ln(f){var p=f.parentNode;return!(!p||!$n(p))&&p}function Nn(f,p){var v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,_=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;if(!T||!f||On(f,"html")||!$n(f))return!1;if(null!=v&&v.url_allowlist&&!xn(v.url_allowlist))return!1;if(null!=v&&v.url_ignorelist&&xn(v.url_ignorelist))return!1;if(null!=v&&v.dom_event_allowlist){var m=v.dom_event_allowlist;if(m&&!m.some((function(f){return p.type===f})))return!1}for(var C=!1,$=[f],O=!0,M=f;M.parentNode&&!On(M,"body");)if(An(M.parentNode))$.push(M.parentNode.host),M=M.parentNode.host;else{if(!(O=Ln(M)))break;if(_||Dn.indexOf(O.tagName.toLowerCase())>-1)C=!0;else{var A=T.getComputedStyle(O);A&&"pointer"===A.getPropertyValue("cursor")&&(C=!0)}$.push(O),M=O}if(!function(f,p){var v=null==p?void 0:p.element_allowlist;if(w(v))return!0;var _,g=h(f);try{var o=function(){var f=_.value;if(v.some((function(p){return f.tagName.toLowerCase()===p})))return{v:!0}};for(g.s();!(_=g.n()).done;){var m=o();if("object"===n(m))return m.v}}catch(f){g.e(f)}finally{g.f()}return!1}($,v))return!1;if(!function(f,p){var v=null==p?void 0:p.css_selector_allowlist;if(w(v))return!0;var _,g=h(f);try{var o=function(){var f=_.value;if(v.some((function(p){return f.matches(p)})))return{v:!0}};for(g.s();!(_=g.n()).done;){var m=o();if("object"===n(m))return m.v}}catch(f){g.e(f)}finally{g.f()}return!1}($,v))return!1;var D=T.getComputedStyle(f);if(D&&"pointer"===D.getPropertyValue("cursor")&&"click"===p.type)return!0;var L=f.tagName.toLowerCase();switch(L){case"html":return!1;case"form":return(g||["submit"]).indexOf(p.type)>=0;case"input":case"select":case"textarea":return(g||["change","click"]).indexOf(p.type)>=0;default:return C?(g||["click"]).indexOf(p.type)>=0:(g||["click"]).indexOf(p.type)>=0&&(Dn.indexOf(L)>-1||"true"===f.getAttribute("contenteditable"))}}function qn(f){for(var p=f;p.parentNode&&!On(p,"body");p=p.parentNode){var v=Pn(p);if(Y(v,"ph-sensitive")||Y(v,"ph-no-capture"))return!1}if(Y(Pn(f),"ph-include"))return!0;var _=f.type||"";if(S(_))switch(_.toLowerCase()){case"hidden":case"password":return!1}var g=f.name||f.id||"";return!S(g)||!/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(g.replace(/[^a-zA-Z0-9]/g,""))}function Bn(f){return!!(On(f,"input")&&!["button","checkbox","submit","reset"].includes(f.type)||On(f,"select")||On(f,"textarea")||"true"===f.getAttribute("contenteditable"))}var Hn="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",Un=new RegExp("^(?:".concat(Hn,")$")),jn=new RegExp(Hn),Wn="\\d{3}-?\\d{2}-?\\d{4}",Gn=new RegExp("^(".concat(Wn,")$")),zn=new RegExp("(".concat(Wn,")"));function Vn(f){var p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(I(f))return!1;if(S(f)){if(f=z(f),(p?Un:jn).test((f||"").replace(/[- ]/g,"")))return!1;if((p?Gn:zn).test(f))return!1}return!0}function Qn(f){var p=Cn(f);return Vn(p="".concat(p," ").concat(Jn(f)).trim())?p:""}function Jn(f){var p="";return f&&f.childNodes&&f.childNodes.length&&Q(f.childNodes,(function(f){var v;if(f&&"span"===(null===(v=f.tagName)||void 0===v?void 0:v.toLowerCase()))try{var _=Cn(f);p="".concat(p," ").concat(_).trim(),f.childNodes&&f.childNodes.length&&(p="".concat(p," ").concat(Jn(f)).trim())}catch(f){W.error(f)}})),p}function Yn(f){return function(f){var p=f.map((function(f){var p,v,_="";if(f.tag_name&&(_+=f.tag_name),f.attr_class){f.attr_class.sort();var g,m=h(f.attr_class);try{for(m.s();!(g=m.n()).done;){var T=g.value;_+=".".concat(T.replace(/"/g,""))}}catch(f){m.e(f)}finally{m.f()}}var C=t(t(t(t({},f.text?{text:f.text}:{}),{},{"nth-child":null!==(p=f.nth_child)&&void 0!==p?p:0,"nth-of-type":null!==(v=f.nth_of_type)&&void 0!==v?v:0},f.href?{href:f.href}:{}),f.attr_id?{attr_id:f.attr_id}:{}),f.attributes),$={};return X(C).sort((function(f,p){var v=u(f,1)[0],_=u(p,1)[0];return v.localeCompare(_)})).forEach((function(f){var p=u(f,2),v=p[0],_=p[1];return $[Xn(v.toString())]=Xn(_.toString())})),_+=":",_+X(C).map((function(f){var p=u(f,2),v=p[0],_=p[1];return"".concat(v,'="').concat(_,'"')})).join("")}));return p.join(";")}(function(f){return f.map((function(f){var p,v,_={text:null===(p=f.$el_text)||void 0===p?void 0:p.slice(0,400),tag_name:f.tag_name,href:null===(v=f.attr__href)||void 0===v?void 0:v.slice(0,2048),attr_class:Kn(f),attr_id:f.attr__id,nth_child:f.nth_child,nth_of_type:f.nth_of_type,attributes:{}};return X(f).filter((function(f){return 0===u(f,1)[0].indexOf("attr__")})).forEach((function(f){var p=u(f,2),v=p[0],g=p[1];return _.attributes[v]=g})),_}))}(f))}function Xn(f){return f.replace(/"|\\"/g,'\\"')}function Kn(f){var p=f.attr__class;return p?m(p)?p:Rn(p):void 0}var Zn="[SessionRecording]",ei="redacted",ti={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:function(f){return f},recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io"]},ni=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],ii=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],ri=["/s/","/e/","/i/"];function si(f,p,v,_){if(I(f))return f;var g=(null==p?void 0:p["content-length"])||function(f){return new Blob([f]).size}(f);return S(g)&&(g=parseInt(g)),g>v?Zn+" ".concat(_," body too large to record (").concat(g," bytes)"):f}function oi(f,p){if(I(f))return f;var v=f;return Vn(v,!1)||(v=Zn+" "+p+" body "+ei),Q(ii,(function(f){var _,g;null!==(_=v)&&void 0!==_&&_.length&&-1!==(null===(g=v)||void 0===g?void 0:g.indexOf(f))&&(v=Zn+" "+p+" body "+ei+" as might contain: "+f)})),v}var ai,ui=function(f,p){var v,_,g,m={payloadSizeLimitBytes:ti.payloadSizeLimitBytes,performanceEntryTypeToObserve:l(ti.performanceEntryTypeToObserve),payloadHostDenyList:[].concat(l(p.payloadHostDenyList||[]),l(ti.payloadHostDenyList))},T=!1!==f.session_recording.recordHeaders&&p.recordHeaders,C=!1!==f.session_recording.recordBody&&p.recordBody,$=!1!==f.capture_performance&&p.recordPerformance,O=(v=m,g=Math.min(1e6,null!==(_=v.payloadSizeLimitBytes)&&void 0!==_?_:1e6),function(f){return null!=f&&f.requestBody&&(f.requestBody=si(f.requestBody,f.requestHeaders,g,"Request")),null!=f&&f.responseBody&&(f.responseBody=si(f.responseBody,f.responseHeaders,g,"Response")),f}),h=function(f){return O(function(f){var p=vt(f.name);if(!(p&&p.pathname&&ri.some((function(f){return 0===p.pathname.indexOf(f)}))))return f}((v=(p=f).requestHeaders,I(v)||Q(Object.keys(null!=v?v:{}),(function(f){ni.includes(f.toLowerCase())&&(v[f]=ei)})),p)));var p,v},M=y(f.session_recording.maskNetworkRequestFn);return M&&y(f.session_recording.maskCapturedNetworkRequestFn)&&W.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),M&&(f.session_recording.maskCapturedNetworkRequestFn=function(p){var v=f.session_recording.maskNetworkRequestFn({url:p.name});return t(t({},p),{},{name:null==v?void 0:v.url})}),m.maskRequestFn=y(f.session_recording.maskCapturedNetworkRequestFn)?function(p){var v,_,g,m=h(p);return m&&null!==(v=null===(_=(g=f.session_recording).maskCapturedNetworkRequestFn)||void 0===_?void 0:_.call(g,m))&&void 0!==v?v:void 0}:function(f){return function(f){if(!w(f))return f.requestBody=oi(f.requestBody,"Request"),f.responseBody=oi(f.responseBody,"Response"),f}(h(f))},t(t(t({},ti),m),{},{recordHeaders:T,recordBody:C,recordPerformance:$,recordInitialRequests:$})},li=s((function e(f){var p,v,_=this,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),o(this,"bucketSize",100),o(this,"refillRate",10),o(this,"mutationBuckets",{}),o(this,"loggedTracker",{}),o(this,"refillBuckets",(function(){Object.keys(_.mutationBuckets).forEach((function(f){_.mutationBuckets[f]=_.mutationBuckets[f]+_.refillRate,_.mutationBuckets[f]>=_.bucketSize&&delete _.mutationBuckets[f]}))})),o(this,"getNodeOrRelevantParent",(function(f){var p=_.rrweb.mirror.getNode(f);if("svg"!==(null==p?void 0:p.nodeName)&&p instanceof Element){var v=p.closest("svg");if(v)return[_.rrweb.mirror.getId(v),v]}return[f,p]})),o(this,"numberOfChanges",(function(f){var p,v,_,g,m,T,C,$;return(null!==(p=null===(v=f.removes)||void 0===v?void 0:v.length)&&void 0!==p?p:0)+(null!==(_=null===(g=f.attributes)||void 0===g?void 0:g.length)&&void 0!==_?_:0)+(null!==(m=null===(T=f.texts)||void 0===T?void 0:T.length)&&void 0!==m?m:0)+(null!==(C=null===($=f.adds)||void 0===$?void 0:$.length)&&void 0!==C?C:0)})),o(this,"throttleMutations",(function(f){if(3!==f.type||0!==f.data.source)return f;var p=f.data,v=_.numberOfChanges(p);p.attributes&&(p.attributes=p.attributes.filter((function(f){var p,v,g,m=u(_.getNodeOrRelevantParent(f.id),2),T=m[0],C=m[1];if(0===_.mutationBuckets[T])return!1;(_.mutationBuckets[T]=null!==(p=_.mutationBuckets[T])&&void 0!==p?p:_.bucketSize,_.mutationBuckets[T]=Math.max(_.mutationBuckets[T]-1,0),0===_.mutationBuckets[T])&&(_.loggedTracker[T]||(_.loggedTracker[T]=!0,null===(v=(g=_.options).onBlockedNode)||void 0===v||v.call(g,T,C)));return f})));var g=_.numberOfChanges(p);return 0!==g||v===g?f:void 0})),this.rrweb=f,this.options=g,this.refillRate=null!==(p=this.options.refillRate)&&void 0!==p?p:this.refillRate,this.bucketSize=null!==(v=this.options.bucketSize)&&void 0!==v?v:this.bucketSize,setInterval((function(){_.refillBuckets()}),1e3)})),ci=3e5,di=[In.MouseMove,In.MouseInteraction,In.Scroll,In.ViewportResize,In.Input,In.TouchMove,In.MediaInteraction,In.Drag],hi=function(f){return{rrwebMethod:f,enqueuedAt:Date.now(),attempt:1}},fi="[SessionRecording]",pi=function(){function e(f){var p=this;if(i(this,e),o(this,"queuedRRWebEvents",[]),o(this,"isIdle",!1),o(this,"_linkedFlagSeen",!1),o(this,"_lastActivityTimestamp",Date.now()),o(this,"_linkedFlag",null),o(this,"_forceAllowLocalhostNetworkCapture",!1),o(this,"_samplingSessionListener",null),this.instance=f,this._captureStarted=!1,this._endpoint="/s/",this.stopRrweb=void 0,this.receivedDecide=!1,null==T||T.addEventListener("beforeunload",(function(){p._flushBuffer()})),null==T||T.addEventListener("offline",(function(){p._tryAddCustomEvent("browser offline",{})})),null==T||T.addEventListener("online",(function(){p._tryAddCustomEvent("browser online",{})})),null==T||T.addEventListener("visibilitychange",(function(){if(null!=D&&D.visibilityState){var f="window "+D.visibilityState;p._tryAddCustomEvent(f,{})}})),!this.instance.sessionManager)throw W.error(fi+" started without valid sessionManager"),new Error(fi+" started without valid sessionManager. This is a bug.");var v=this.sessionManager.checkAndGetSessionAndWindowId(),_=v.sessionId,g=v.windowId;this.sessionId=_,this.windowId=g,this.buffer=this.clearBuffer(),this._setupSampling()}return s(e,[{key:"rrwebRecord",get:function(){var f;return null==U||null===(f=U.rrweb)||void 0===f?void 0:f.record}},{key:"started",get:function(){return this._captureStarted}},{key:"sessionManager",get:function(){if(!this.instance.sessionManager)throw new Error(fi+" must be started with a valid sessionManager.");return this.instance.sessionManager}},{key:"fullSnapshotIntervalMillis",get:function(){var f;return(null===(f=this.instance.config.session_recording)||void 0===f?void 0:f.full_snapshot_interval_millis)||ci}},{key:"isSampled",get:function(){var f=this.instance.get_property(Ee);return x(f)?f:null}},{key:"sessionDuration",get:function(){var f,p,v=null===(f=this.buffer)||void 0===f?void 0:f.data[(null===(p=this.buffer)||void 0===p?void 0:p.data.length)-1],_=this.sessionManager.checkAndGetSessionAndWindowId(!0).sessionStartTimestamp;return v?v.timestamp-_:null}},{key:"isRecordingEnabled",get:function(){var f=!!this.instance.get_property(ge),p=!this.instance.config.disable_session_recording;return T&&f&&p}},{key:"isConsoleLogCaptureEnabled",get:function(){var f=!!this.instance.get_property(me),p=this.instance.config.enable_recording_console_log;return null!=p?p:f}},{key:"canvasRecording",get:function(){var f=this.instance.get_property(be);return f&&f.fps&&f.quality?{enabled:f.enabled,fps:f.fps,quality:f.quality}:void 0}},{key:"networkPayloadCapture",get:function(){var f,p,v=this.instance.get_property(ye),_={recordHeaders:null===(f=this.instance.config.session_recording)||void 0===f?void 0:f.recordHeaders,recordBody:null===(p=this.instance.config.session_recording)||void 0===p?void 0:p.recordBody},g=(null==_?void 0:_.recordHeaders)||(null==v?void 0:v.recordHeaders),m=(null==_?void 0:_.recordBody)||(null==v?void 0:v.recordBody),T=b(this.instance.config.capture_performance)?this.instance.config.capture_performance.network_timing:this.instance.config.capture_performance,C=!!(x(T)?T:null==v?void 0:v.capturePerformance);return g||m||C?{recordHeaders:g,recordBody:m,recordPerformance:C}:void 0}},{key:"sampleRate",get:function(){var f=this.instance.get_property(ke);return R(f)?f:null}},{key:"minimumDuration",get:function(){var f=this.instance.get_property(we);return R(f)?f:null}},{key:"status",get:function(){return this.receivedDecide?this.isRecordingEnabled?I(this._linkedFlag)||this._linkedFlagSeen?x(this.isSampled)?this.isSampled?"sampled":"disabled":"active":"buffering":"disabled":"buffering"}},{key:"startIfEnabledOrStop",value:function(){this.isRecordingEnabled?(this._startCapture(),W.info(fi+" started")):(this.stopRecording(),this.clearBuffer())}},{key:"stopRecording",value:function(){this._captureStarted&&this.stopRrweb&&(this.stopRrweb(),this.stopRrweb=void 0,this._captureStarted=!1,W.info(fi+" stopped"))}},{key:"makeSamplingDecision",value:function(f){var p,v=this.sessionId!==f,_=this.sampleRate;if(R(_)){var g,m=this.isSampled,T=v||!x(m);g=T?Math.random()<_:m;!g&&T&&W.warn(fi+" Sample rate (".concat(_,") has determined that this sessionId (").concat(f,") will not be sent to the server.")),this._tryAddCustomEvent("samplingDecisionMade",{sampleRate:_}),null===(p=this.instance.persistence)||void 0===p||p.register(o({},Ee,g))}else{var C;null===(C=this.instance.persistence)||void 0===C||C.register(o({},Ee,null))}}},{key:"afterDecideResponse",value:function(f){var p,v,_,g=this;(this._persistDecideResponse(f),this._linkedFlag=(null===(p=f.sessionRecording)||void 0===p?void 0:p.linkedFlag)||null,null!==(v=f.sessionRecording)&&void 0!==v&&v.endpoint)&&(this._endpoint=null===(_=f.sessionRecording)||void 0===_?void 0:_.endpoint);if(this._setupSampling(),!I(this._linkedFlag)){var m=S(this._linkedFlag)?this._linkedFlag:this._linkedFlag.flag,T=S(this._linkedFlag)?null:this._linkedFlag.variant;this.instance.onFeatureFlags((function(f,p){var v=b(p)&&m in p,_=T?p[m]===T:v;if(_){var C={linkedFlag:m,linkedVariant:T},$="linked flag matched";W.info(fi+" "+$,C),g._tryAddCustomEvent($,C)}g._linkedFlagSeen=_}))}this.receivedDecide=!0,this.startIfEnabledOrStop()}},{key:"_setupSampling",value:function(){var f=this;R(this.sampleRate)&&F(this._samplingSessionListener)&&(this._samplingSessionListener=this.sessionManager.onSessionId((function(p){f.makeSamplingDecision(p)})))}},{key:"_persistDecideResponse",value:function(f){if(this.instance.persistence){var p=this.instance.persistence,i=function(){var v,_,g,m,T,C,$,O,M=null===(v=f.sessionRecording)||void 0===v?void 0:v.sampleRate,A=I(M)?null:parseFloat(M),D=null===(_=f.sessionRecording)||void 0===_?void 0:_.minimumDurationMilliseconds;p.register((o(O={},ge,!!f.sessionRecording),o(O,me,null===(g=f.sessionRecording)||void 0===g?void 0:g.consoleLogRecordingEnabled),o(O,ye,t({capturePerformance:f.capturePerformance},null===(m=f.sessionRecording)||void 0===m?void 0:m.networkPayloadCapture)),o(O,be,{enabled:null===(T=f.sessionRecording)||void 0===T?void 0:T.recordCanvas,fps:null===(C=f.sessionRecording)||void 0===C?void 0:C.canvasFps,quality:null===($=f.sessionRecording)||void 0===$?void 0:$.canvasQuality}),o(O,ke,A),o(O,we,w(D)?null:D),O))};i(),this.sessionManager.onSessionId(i)}}},{key:"log",value:function(f){var p,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log";null===(p=this.instance.sessionRecording)||void 0===p||p.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:v,trace:[],payload:[JSON.stringify(f)]}},timestamp:K()})}},{key:"_startCapture",value:function(){var p=this;w(Object.assign)||this._captureStarted||this.instance.config.disable_session_recording||this.instance.consent.isOptedOut()||(this._captureStarted=!0,this.sessionManager.checkAndGetSessionAndWindowId(),this.rrwebRecord?this._onScriptLoaded():this.instance.requestRouter.loadScript("/static/recorder.js?v=".concat(f.LIB_VERSION),(function(f){if(f)return W.error(fi+" could not load recorder.js",f);p._onScriptLoaded()})))}},{key:"isInteractiveEvent",value:function(f){var p;return 3===f.type&&-1!==di.indexOf(null===(p=f.data)||void 0===p?void 0:p.source)}},{key:"_updateWindowAndSessionIds",value:function(f){var p=this.isInteractiveEvent(f);p||this.isIdle||f.timestamp-this._lastActivityTimestamp>3e5&&(this.isIdle=!0,clearTimeout(this._fullSnapshotTimer),this._flushBuffer());var v=!1;if(p&&(this._lastActivityTimestamp=f.timestamp,this.isIdle&&(this.isIdle=!1,this._tryAddCustomEvent("sessionNoLongerIdle",{reason:"user activity",type:f.type}),v=!0)),!this.isIdle){var _=this.sessionManager.checkAndGetSessionAndWindowId(!p,f.timestamp),g=_.windowId,m=_.sessionId,T=this.sessionId!==m,C=this.windowId!==g;this.windowId=g,this.sessionId=m,(v||-1===[wn,Sn].indexOf(f.type)&&(C||T||w(this._fullSnapshotTimer)))&&this._tryTakeFullSnapshot()}}},{key:"_tryRRWebMethod",value:function(f){try{return f.rrwebMethod(),!0}catch(p){return this.queuedRRWebEvents.length<10?this.queuedRRWebEvents.push({enqueuedAt:f.enqueuedAt||Date.now(),attempt:f.attempt++,rrwebMethod:f.rrwebMethod}):W.warn(fi+" could not emit queued rrweb event.",p,f),!1}}},{key:"_tryAddCustomEvent",value:function(f,p){var v=this;return this._tryRRWebMethod(hi((function(){return v.rrwebRecord.addCustomEvent(f,p)})))}},{key:"_tryTakeFullSnapshot",value:function(){var f=this;return this._tryRRWebMethod(hi((function(){return f.rrwebRecord.takeFullSnapshot()})))}},{key:"_onScriptLoaded",value:function(){for(var f,p=this,v={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},_=this.instance.config.session_recording,g=0,m=Object.entries(_||{});g<m.length;g++){var C=u(m[g],2),$=C[0],O=C[1];$ in v&&(v[$]=O)}if(this.canvasRecording&&this.canvasRecording.enabled&&(v.recordCanvas=!0,v.sampling={canvas:this.canvasRecording.fps},v.dataURLOptions={type:"image/webp",quality:this.canvasRecording.quality}),this.rrwebRecord){this.mutationRateLimiter=null!==(f=this.mutationRateLimiter)&&void 0!==f?f:new li(this.rrwebRecord,{onBlockedNode:function(f,v){var _="Too many mutations on node '".concat(f,"'. Rate limiting. This could be due to SVG animations or something similar");W.info(_,{node:v}),p.log(fi+" "+_,"warn")}});var M=this._gatherRRWebPlugins();this.stopRrweb=this.rrwebRecord(t({emit:function(f){p.onRRwebEmit(f)},plugins:M},v)),this.instance._addCaptureHook((function(f){try{if("$pageview"===f){var v=T?p._maskUrl(T.location.href):"";if(!v)return;p._tryAddCustomEvent("$pageview",{href:v})}}catch(f){W.error("Could not add $pageview to rrweb session",f)}})),this._lastActivityTimestamp=Date.now(),this.isIdle=!1,this._tryAddCustomEvent("$session_options",{sessionRecordingOptions:v,activePlugins:M.map((function(f){return null==f?void 0:f.name}))}),this._tryAddCustomEvent("$posthog_config",{config:this.instance.config})}else W.error(fi+"onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}},{key:"_scheduleFullSnapshot",value:function(){var f=this;if(this._fullSnapshotTimer&&clearInterval(this._fullSnapshotTimer),!this.isIdle){var p=this.fullSnapshotIntervalMillis;p&&(this._fullSnapshotTimer=setInterval((function(){f._tryTakeFullSnapshot()}),p))}}},{key:"_gatherRRWebPlugins",value:function(){var f=[];(U.rrwebConsoleRecord&&this.isConsoleLogCaptureEnabled&&f.push(U.rrwebConsoleRecord.getRecordConsolePlugin()),this.networkPayloadCapture&&y(U.getRecordNetworkPlugin))&&(!pt.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?f.push(U.getRecordNetworkPlugin(ui(this.instance.config,this.networkPayloadCapture))):W.info(fi+" NetworkCapture not started because we are on localhost."));return f}},{key:"onRRwebEmit",value:function(f){if(this._processQueuedEvents(),f&&b(f)){if(f.type===Fn.Meta){var p=this._maskUrl(f.data.href);if(this._lastHref=p,!p)return;f.data.href=p}else this._pageViewFallBack();f.type===Fn.FullSnapshot&&this._scheduleFullSnapshot();var v=this.mutationRateLimiter?this.mutationRateLimiter.throttleMutations(f):f;if(v){var _=function(f){var p=f;if(p&&b(p)&&6===p.type&&b(p.data)&&"rrweb/console@1"===p.data.plugin){p.data.payload.payload.length>10&&(p.data.payload.payload=p.data.payload.payload.slice(0,10),p.data.payload.payload.push("...[truncated]"));for(var v=[],_=0;_<p.data.payload.payload.length;_++)p.data.payload.payload[_]&&p.data.payload.payload[_].length>2e3?v.push(p.data.payload.payload[_].slice(0,2e3)+"...[truncated]"):v.push(p.data.payload.payload[_]);return p.data.payload.payload=v,f}return f}(v),g=kn(_);if(this._updateWindowAndSessionIds(_),!this.isIdle||_.type===Fn.Custom){var m={$snapshot_bytes:g,$snapshot_data:_,$session_id:this.sessionId,$window_id:this.windowId};"disabled"!==this.status?this._captureSnapshotBuffered(m):this.clearBuffer()}}}}},{key:"_pageViewFallBack",value:function(){if(!this.instance.config.capture_pageview&&T){var f=this._maskUrl(T.location.href);this._lastHref!==f&&(this._tryAddCustomEvent("$url_changed",{href:f}),this._lastHref=f)}}},{key:"_processQueuedEvents",value:function(){var f=this;if(this.queuedRRWebEvents.length){var p=l(this.queuedRRWebEvents);this.queuedRRWebEvents=[],p.forEach((function(p){Date.now()-p.enqueuedAt<=2e3&&f._tryRRWebMethod(p)}))}}},{key:"_maskUrl",value:function(f){var p=this.instance.config.session_recording;if(p.maskNetworkRequestFn){var v,_={url:f};return null===(v=_=p.maskNetworkRequestFn(_))||void 0===v?void 0:v.url}return f}},{key:"clearBuffer",value:function(){return this.buffer={size:0,data:[],sessionId:this.sessionId,windowId:this.windowId},this.buffer}},{key:"_flushBuffer",value:function(){var f=this;this.flushBufferTimer&&(clearTimeout(this.flushBufferTimer),this.flushBufferTimer=void 0);var p=this.minimumDuration,v=this.sessionDuration,_=R(v)&&v>=0,g=R(p)&&_&&v<p;if("buffering"===this.status||g)return this.flushBufferTimer=setTimeout((function(){f._flushBuffer()}),2e3),this.buffer;this.buffer.data.length>0&&En(this.buffer).forEach((function(p){f._captureSnapshot({$snapshot_bytes:p.size,$snapshot_data:p.data,$session_id:p.sessionId,$window_id:p.windowId})}));return this.clearBuffer()}},{key:"_captureSnapshotBuffered",value:function(f){var p,v=this,_=2+((null===(p=this.buffer)||void 0===p?void 0:p.data.length)||0);(this.buffer.size+f.$snapshot_bytes+_>943718.4||this.buffer.sessionId!==this.sessionId)&&(this.buffer=this._flushBuffer()),this.buffer.size+=f.$snapshot_bytes,this.buffer.data.push(f.$snapshot_data),this.flushBufferTimer||(this.flushBufferTimer=setTimeout((function(){v._flushBuffer()}),2e3))}},{key:"_captureSnapshot",value:function(f){this.instance.capture("$snapshot",f,{_url:this.instance.requestRouter.endpointFor("api",this._endpoint),_noTruncate:!0,_batchKey:"recordings"})}}]),e}(),vi=function(){function e(f){i(this,e),this.instance=f,this.instance.decideEndpointWasHit=this.instance._hasBootstrappedFeatureFlags()}return s(e,[{key:"call",value:function(){var f=this,p={token:this.instance.config.token,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),person_properties:this.instance.get_property(Re),group_properties:this.instance.get_property(xe),disable_flags:this.instance.config.advanced_disable_feature_flags||this.instance.config.advanced_disable_feature_flags_on_first_load||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:p,compression:this.instance.config.disable_compression?void 0:re.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(p){return f.parseDecideResponse(p.json)}})}},{key:"parseDecideResponse",value:function(f){var p=this;this.instance.featureFlags.setReloadingPaused(!1),this.instance.featureFlags._startReloadTimer();var v=!f;if(this.instance.config.advanced_disable_feature_flags_on_first_load||this.instance.config.advanced_disable_feature_flags||this.instance.featureFlags.receivedFeatureFlags(null!=f?f:{},v),v)W.error("Failed to fetch feature flags from PostHog.");else{if(!D||!D.body)return W.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout((function(){p.parseDecideResponse(f)}),500);if(this.instance._afterDecideResponse(f),f.siteApps)if(this.instance.config.opt_in_site_apps){var _,g=h(f.siteApps);try{var s=function(){var f=_.value,v=f.id,g=f.url,m=p.instance.requestRouter.endpointFor("api",g);U["__$$ph_site_app_".concat(v)]=p.instance,p.instance.requestRouter.loadScript(m,(function(f){f&&W.error("Error while initializing PostHog app with config id ".concat(v),f)}))};for(g.s();!(_=g.n()).done;)s()}catch(f){g.e(f)}finally{g.f()}}else f.siteApps.length>0&&W.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}}]),e}(),_i=null!=T&&T.location?yt(T.location.hash,"__posthog")||yt(location.hash,"state"):null,gi="_postHogToolbarParams";!function(f){f[f.UNINITIALIZED=0]="UNINITIALIZED",f[f.LOADING=1]="LOADING",f[f.LOADED=2]="LOADED"}(ai||(ai={}));var mi=function(){function e(f){i(this,e),this.instance=f}return s(e,[{key:"setToolbarState",value:function(f){U.ph_toolbar_state=f}},{key:"getToolbarState",value:function(){var f;return null!==(f=U.ph_toolbar_state)&&void 0!==f?f:ai.UNINITIALIZED}},{key:"maybeLoadToolbar",value:function(){var f,p,v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,_=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!T||!D)return!1;v=null!==(f=v)&&void 0!==f?f:T.location,g=null!==(p=g)&&void 0!==p?p:T.history;try{if(!_){try{T.localStorage.setItem("test","test"),T.localStorage.removeItem("test")}catch(f){return!1}_=null==T?void 0:T.localStorage}var m,C=_i||yt(v.hash,"__posthog")||yt(v.hash,"state"),$=C?Z((function(){return JSON.parse(atob(decodeURIComponent(C)))}))||Z((function(){return JSON.parse(decodeURIComponent(C))})):null;return $&&"ph_authorize"===$.action?((m=$).source="url",m&&Object.keys(m).length>0&&($.desiredHash?v.hash=$.desiredHash:g?g.replaceState(g.state,"",v.pathname+v.search):v.hash="")):((m=JSON.parse(_.getItem(gi)||"{}")).source="localstorage",delete m.userIntent),!(!m.token||this.instance.config.token!==m.token)&&(this.loadToolbar(m),!0)}catch(f){return!1}}},{key:"_callLoadToolbar",value:function(f){(U.ph_load_toolbar||U.ph_load_editor)(f,this.instance)}},{key:"loadToolbar",value:function(f){var p=this,v=!(null==D||!D.getElementById(qe));if(!T||v)return!1;var _="custom"===this.instance.requestRouter.region&&this.instance.config.advanced_disable_toolbar_metrics,g=t(t({token:this.instance.config.token},f),{},{apiURL:this.instance.requestRouter.endpointFor("ui")},_?{instrument:!1}:{});if(T.localStorage.setItem(gi,JSON.stringify(t(t({},g),{},{source:void 0}))),this.getToolbarState()===ai.LOADED)this._callLoadToolbar(g);else if(this.getToolbarState()===ai.UNINITIALIZED){this.setToolbarState(ai.LOADING);var m=3e5,C=Math.floor(Date.now()/m)*m;this.instance.requestRouter.loadScript("/static/toolbar.js?t=".concat(C),(function(f){if(f)return W.error("Failed to load toolbar",f),void p.setToolbarState(ai.UNINITIALIZED);p.setToolbarState(ai.LOADED),p._callLoadToolbar(g)})),oe(T,"turbolinks:load",(function(){p.setToolbarState(ai.UNINITIALIZED),p.loadToolbar(g)}))}return!0}},{key:"_loadEditor",value:function(f){return this.loadToolbar(f)}},{key:"maybeLoadEditor",value:function(){var f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return this.maybeLoadToolbar(f,p,v)}}]),e}(),yi=function(){function e(f){i(this,e),o(this,"isPaused",!0),o(this,"queue",[]),o(this,"flushTimeoutMs",3e3),this.sendRequest=f}return s(e,[{key:"enqueue",value:function(f){this.queue.push(f),this.flushTimeout||this.setFlushTimeout()}},{key:"unload",value:function(){var f=this;this.clearFlushTimeout();var p=this.queue.length>0?this.formatQueue():{},v=Object.values(p),_=[].concat(l(v.filter((function(f){return 0===f.url.indexOf("/e")}))),l(v.filter((function(f){return 0!==f.url.indexOf("/e")}))));_.map((function(p){f.sendRequest(t(t({},p),{},{transport:"sendBeacon"}))}))}},{key:"enable",value:function(){this.isPaused=!1,this.setFlushTimeout()}},{key:"setFlushTimeout",value:function(){var f=this;this.isPaused||(this.flushTimeout=setTimeout((function(){if(f.clearFlushTimeout(),f.queue.length>0){var p=f.formatQueue(),n=function(v){var _=p[v],g=(new Date).getTime();_.data&&m(_.data)&&Q(_.data,(function(f){f.offset=Math.abs(f.timestamp-g),delete f.timestamp})),f.sendRequest(_)};for(var v in p)n(v)}}),this.flushTimeoutMs))}},{key:"clearFlushTimeout",value:function(){clearTimeout(this.flushTimeout),this.flushTimeout=void 0}},{key:"formatQueue",value:function(){var f={};return Q(this.queue,(function(p){var v,_=p,g=(_?_.batchKey:null)||_.url;w(f[g])&&(f[g]=t(t({},_),{},{data:[]})),null===(v=f[g].data)||void 0===v||v.push(_.data)})),this.queue=[],f}}]),e}(),bi=Uint8Array,ki=Uint16Array,wi=Uint32Array,Si=new bi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ei=new bi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fi=new bi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ii=function(f,p){for(var v=new ki(31),_=0;_<31;++_)v[_]=p+=1<<f[_-1];var g=new wi(v[30]);for(_=1;_<30;++_)for(var m=v[_];m<v[_+1];++m)g[m]=m-v[_]<<5|_;return[v,g]},Ri=Ii(Si,2),xi=Ri[0],Pi=Ri[1];xi[28]=258,Pi[258]=28;for(var Ti=Ii(Ei,0)[1],Ci=new ki(32768),$i=0;$i<32768;++$i){var Oi=(43690&$i)>>>1|(21845&$i)<<1;Oi=(61680&(Oi=(52428&Oi)>>>2|(13107&Oi)<<2))>>>4|(3855&Oi)<<4,Ci[$i]=((65280&Oi)>>>8|(255&Oi)<<8)>>>1}var Mi=function(f,p,v){for(var _=f.length,g=0,m=new ki(p);g<_;++g)++m[f[g]-1];var T,C=new ki(p);for(g=0;g<p;++g)C[g]=C[g-1]+m[g-1]<<1;if(v){T=new ki(1<<p);var $=15-p;for(g=0;g<_;++g)if(f[g])for(var O=g<<4|f[g],M=p-f[g],A=C[f[g]-1]++<<M,D=A|(1<<M)-1;A<=D;++A)T[Ci[A]>>>$]=O}else for(T=new ki(_),g=0;g<_;++g)T[g]=Ci[C[f[g]-1]++]>>>15-f[g];return T},Ai=new bi(288);for($i=0;$i<144;++$i)Ai[$i]=8;for($i=144;$i<256;++$i)Ai[$i]=9;for($i=256;$i<280;++$i)Ai[$i]=7;for($i=280;$i<288;++$i)Ai[$i]=8;var Di=new bi(32);for($i=0;$i<32;++$i)Di[$i]=5;var Li=Mi(Ai,9,0),Ni=Mi(Di,5,0),qi=function(f){return(f/8|0)+(7&f&&1)},Bi=function(f,p,v){(null==p||p<0)&&(p=0),(null==v||v>f.length)&&(v=f.length);var _=new(f instanceof ki?ki:f instanceof wi?wi:bi)(v-p);return _.set(f.subarray(p,v)),_},Hi=function(f,p,v){v<<=7&p;var _=p/8|0;f[_]|=v,f[_+1]|=v>>>8},Ui=function(f,p,v){v<<=7&p;var _=p/8|0;f[_]|=v,f[_+1]|=v>>>8,f[_+2]|=v>>>16},ji=function(f,p){for(var v=[],_=0;_<f.length;++_)f[_]&&v.push({s:_,f:f[_]});var g=v.length,m=v.slice();if(!g)return[new bi(0),0];if(1==g){var T=new bi(v[0].s+1);return T[v[0].s]=1,[T,1]}v.sort((function(f,p){return f.f-p.f})),v.push({s:-1,f:25001});var C=v[0],$=v[1],O=0,M=1,A=2;for(v[0]={s:-1,f:C.f+$.f,l:C,r:$};M!=g-1;)C=v[v[O].f<v[A].f?O++:A++],$=v[O!=M&&v[O].f<v[A].f?O++:A++],v[M++]={s:-1,f:C.f+$.f,l:C,r:$};var D=m[0].s;for(_=1;_<g;++_)m[_].s>D&&(D=m[_].s);var L=new ki(D+1),N=Wi(v[M-1],L,0);if(N>p){_=0;var q=0,B=N-p,H=1<<B;for(m.sort((function(f,p){return L[p.s]-L[f.s]||f.f-p.f}));_<g;++_){var U=m[_].s;if(!(L[U]>p))break;q+=H-(1<<N-L[U]),L[U]=p}for(q>>>=B;q>0;){var j=m[_].s;L[j]<p?q-=1<<p-L[j]++-1:++_}for(;_>=0&&q;--_){var W=m[_].s;L[W]==p&&(--L[W],++q)}N=p}return[new bi(L),N]},Wi=function e(f,p,v){return-1==f.s?Math.max(e(f.l,p,v+1),e(f.r,p,v+1)):p[f.s]=v},Gi=function(f){for(var p=f.length;p&&!f[--p];);for(var v=new ki(++p),_=0,g=f[0],m=1,o=function(f){v[_++]=f},T=1;T<=p;++T)if(f[T]==g&&T!=p)++m;else{if(!g&&m>2){for(;m>138;m-=138)o(32754);m>2&&(o(m>10?m-11<<5|28690:m-3<<5|12305),m=0)}else if(m>3){for(o(g),--m;m>6;m-=6)o(8304);m>2&&(o(m-3<<5|8208),m=0)}for(;m--;)o(g);m=1,g=f[T]}return[v.subarray(0,_),p]},zi=function(f,p){for(var v=0,_=0;_<p.length;++_)v+=f[_]*p[_];return v},Vi=function(f,p,v){var _=v.length,g=qi(p+2);f[g]=255&_,f[g+1]=_>>>8,f[g+2]=255^f[g],f[g+3]=255^f[g+1];for(var m=0;m<_;++m)f[g+m+4]=v[m];return 8*(g+4+_)},Qi=function(f,p,v,_,g,m,T,C,$,O,M){Hi(p,M++,v),++g[256];for(var A=ji(g,15),D=A[0],L=A[1],N=ji(m,15),q=N[0],B=N[1],H=Gi(D),U=H[0],j=H[1],W=Gi(q),G=W[0],re=W[1],oe=new ki(19),ue=0;ue<U.length;++ue)oe[31&U[ue]]++;for(ue=0;ue<G.length;++ue)oe[31&G[ue]]++;for(var le=ji(oe,7),ce=le[0],de=le[1],he=19;he>4&&!ce[Fi[he-1]];--he);var fe,pe,ve,_e,ge=O+5<<3,me=zi(g,Ai)+zi(m,Di)+T,ye=zi(g,D)+zi(m,q)+T+14+3*he+zi(oe,ce)+(2*oe[16]+3*oe[17]+7*oe[18]);if(ge<=me&&ge<=ye)return Vi(p,M,f.subarray($,$+O));if(Hi(p,M,1+(ye<me)),M+=2,ye<me){fe=Mi(D,L,0),pe=D,ve=Mi(q,B,0),_e=q;var be=Mi(ce,de,0);Hi(p,M,j-257),Hi(p,M+5,re-1),Hi(p,M+10,he-4),M+=14;for(ue=0;ue<he;++ue)Hi(p,M+3*ue,ce[Fi[ue]]);M+=3*he;for(var ke=[U,G],we=0;we<2;++we){var Se=ke[we];for(ue=0;ue<Se.length;++ue){var Ee=31&Se[ue];Hi(p,M,be[Ee]),M+=ce[Ee],Ee>15&&(Hi(p,M,Se[ue]>>>5&127),M+=Se[ue]>>>12)}}}else fe=Li,pe=Ai,ve=Ni,_e=Di;for(ue=0;ue<C;++ue)if(_[ue]>255){Ee=_[ue]>>>18&31;Ui(p,M,fe[Ee+257]),M+=pe[Ee+257],Ee>7&&(Hi(p,M,_[ue]>>>23&31),M+=Si[Ee]);var Fe=31&_[ue];Ui(p,M,ve[Fe]),M+=_e[Fe],Fe>3&&(Ui(p,M,_[ue]>>>5&8191),M+=Ei[Fe])}else Ui(p,M,fe[_[ue]]),M+=pe[_[ue]];return Ui(p,M,fe[256]),M+pe[256]},Yi=new wi([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ji=new bi(0),Xi=function(){for(var f=new wi(256),p=0;p<256;++p){for(var v=p,_=9;--_;)v=(1&v&&3988292384)^v>>>1;f[p]=v}return f}(),Ki=function(f,p,v,_,g){return function(f,p,v,_,g,m){var T=f.length,C=new bi(_+T+5*(1+Math.floor(T/7e3))+g),$=C.subarray(_,C.length-g),O=0;if(!p||T<8)for(var M=0;M<=T;M+=65535){var A=M+65535;A<T?O=Vi($,O,f.subarray(M,A)):($[M]=m,O=Vi($,O,f.subarray(M,T)))}else{for(var D=Yi[p-1],L=D>>>13,N=8191&D,q=(1<<v)-1,B=new ki(32768),H=new ki(q+1),U=Math.ceil(v/3),j=2*U,b=function(p){return(f[p]^f[p+1]<<U^f[p+2]<<j)&q},W=new wi(25e3),G=new ki(288),re=new ki(32),oe=0,ue=0,le=(M=0,0),ce=0,de=0;M<T;++M){var he=b(M),fe=32767&M,pe=H[he];if(B[fe]=pe,H[he]=fe,ce<=M){var ve=T-M;if((oe>7e3||le>24576)&&ve>423){O=Qi(f,$,0,W,G,re,ue,le,de,M-de,O),le=oe=ue=0,de=M;for(var _e=0;_e<286;++_e)G[_e]=0;for(_e=0;_e<30;++_e)re[_e]=0}var ge=2,me=0,ye=N,be=fe-pe&32767;if(ve>2&&he==b(M-be))for(var ke=Math.min(L,ve)-1,we=Math.min(32767,M),Se=Math.min(258,ve);be<=we&&--ye&&fe!=pe;){if(f[M+ge]==f[M+ge-be]){for(var Ee=0;Ee<Se&&f[M+Ee]==f[M+Ee-be];++Ee);if(Ee>ge){if(ge=Ee,me=be,Ee>ke)break;var Fe=Math.min(be,Ee-2),Ie=0;for(_e=0;_e<Fe;++_e){var Re=M-be+_e+32768&32767,xe=Re-B[Re]+32768&32767;xe>Ie&&(Ie=xe,pe=Re)}}}be+=(fe=pe)-(pe=B[fe])+32768&32767}if(me){W[le++]=268435456|Pi[ge]<<18|Ti[me];var Pe=31&Pi[ge],Te=31&Ti[me];ue+=Si[Pe]+Ei[Te],++G[257+Pe],++re[Te],ce=M+ge,++oe}else W[le++]=f[M],++G[f[M]]}}O=Qi(f,$,m,W,G,re,ue,le,de,M-de,O),m||(O=Vi($,O,Ji))}return Bi(C,0,_+qi(O)+g)}(f,null==p.level?6:p.level,null==p.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(f.length)))):12+p.mem,v,_,!g)},Zi=function(f,p,v){for(;v;++p)f[p]=v,v>>>=8};function er(f,p){void 0===p&&(p={});var v=function(){var f=4294967295;return{p:function(p){for(var v=f,_=0;_<p.length;++_)v=Xi[255&v^p[_]]^v>>>8;f=v},d:function(){return 4294967295^f}}}(),_=f.length;v.p(f);var g=Ki(f,p,function(f){return 10+(f.filename&&f.filename.length+1||0)}(p),8),m=g.length;return function(f,p){var v=p.filename;if(f[0]=31,f[1]=139,f[2]=8,f[8]=p.level<2?4:9==p.level?2:0,f[9]=3,0!=p.mtime&&Zi(f,4,Math.floor(new Date(p.mtime||Date.now())/1e3)),v){f[3]=8;for(var _=0;_<=v.length;++_)f[_+10]=v.charCodeAt(_)}}(g,p),Zi(g,m-8,v.d()),Zi(g,m-4,_),g}var tr=!!q||!!N,nr="text/plain",ir=function(f,p){var v=u(f.split("?"),2),_=v[0],g=v[1],m=t({},p);null==g||g.split("&").forEach((function(f){var p=u(f.split("="),1)[0];delete m[p]}));var T=gt(m);return T=T?(g?g+"&":"")+T:g,"".concat(_,"?").concat(T)},rr=function(f){return"data="+encodeURIComponent("string"==typeof f?f:JSON.stringify(f))},sr=function(f){var p=f.data,v=f.compression;if(p){if(v===re.GZipJS){var _=er(function(f,p){var v=f.length;if(!p&&"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(f);for(var _=new bi(f.length+(f.length>>>1)),g=0,s=function(f){_[g++]=f},m=0;m<v;++m){if(g+5>_.length){var T=new bi(g+8+(v-m<<1));T.set(_),_=T}var C=f.charCodeAt(m);C<128||p?s(C):C<2048?(s(192|C>>>6),s(128|63&C)):C>55295&&C<57344?(s(240|(C=65536+(1047552&C)|1023&f.charCodeAt(++m))>>>18),s(128|C>>>12&63),s(128|C>>>6&63),s(128|63&C)):(s(224|C>>>12),s(128|C>>>6&63),s(128|63&C))}return Bi(_,0,g)}(JSON.stringify(p)),{mtime:0});return{contentType:nr,body:new Blob([_],{type:nr})}}if(v===re.Base64){var g=function(f){var p,v,_,g,m,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",C=0,$=0,O="",M=[];if(!f)return f;f=se(f);do{p=(m=f.charCodeAt(C++)<<16|f.charCodeAt(C++)<<8|f.charCodeAt(C++))>>18&63,v=m>>12&63,_=m>>6&63,g=63&m,M[$++]=T.charAt(p)+T.charAt(v)+T.charAt(_)+T.charAt(g)}while(C<f.length);switch(O=M.join(""),f.length%3){case 1:O=O.slice(0,-2)+"==";break;case 2:O=O.slice(0,-1)+"="}return O}(JSON.stringify(p));return{contentType:"application/x-www-form-urlencoded",body:rr(g)}}return{contentType:"application/json",body:JSON.stringify(p)}}},or=[];q&&or.push({transport:"XHR",method:function(f){var p,v=new q;v.open(f.method||"GET",f.url,!0);var _=null!==(p=sr(f))&&void 0!==p?p:{},g=_.contentType,m=_.body;Q(f.headers,(function(f,p){v.setRequestHeader(p,f)})),g&&v.setRequestHeader("Content-Type",g),f.timeout&&(v.timeout=f.timeout),v.withCredentials=!0,v.onreadystatechange=function(){if(4===v.readyState){var p,_={statusCode:v.status,text:v.responseText};if(200===v.status)try{_.json=JSON.parse(v.responseText)}catch(f){}null===(p=f.callback)||void 0===p||p.call(f,_)}},v.send(m)}}),N&&or.push({transport:"fetch",method:function(f){var p,v,_=null!==(p=sr(f))&&void 0!==p?p:{},g=_.contentType,m=_.body,T=new Headers;Q(T,(function(f,p){T.append(p,f)})),g&&T.append("Content-Type",g);var C=f.url,$=null;if(B){var O=new B;$={signal:O.signal,timeout:setTimeout((function(){return O.abort()}),f.timeout)}}N(C,{method:(null==f?void 0:f.method)||"GET",headers:T,keepalive:"POST"===f.method,body:m,signal:null===(v=$)||void 0===v?void 0:v.signal}).then((function(p){return p.text().then((function(v){var _,g={statusCode:p.status,text:v};if(200===p.status)try{g.json=JSON.parse(v)}catch(f){W.error(f)}null===(_=f.callback)||void 0===_||_.call(f,g)}))})).catch((function(p){var v;W.error(p),null===(v=f.callback)||void 0===v||v.call(f,{statusCode:0,text:p})})).finally((function(){return $?clearTimeout($.timeout):null}))}}),null!=A&&A.sendBeacon&&or.push({transport:"sendBeacon",method:function(f){var p=ir(f.url,{beacon:"1"});try{var v,_=null!==(v=sr(f))&&void 0!==v?v:{},g=_.contentType,m=_.body,T="string"==typeof m?new Blob([m],{type:g}):m;A.sendBeacon(p,T)}catch(f){}}});var ar=["retriesPerformedSoFar"];var ur,lr=function(){function e(f){var p=this;i(this,e),o(this,"isPolling",!1),o(this,"pollIntervalMs",3e3),o(this,"queue",[]),this.instance=f,this.queue=[],this.areWeOnline=!0,!w(T)&&"onLine"in T.navigator&&(this.areWeOnline=T.navigator.onLine,T.addEventListener("online",(function(){p.areWeOnline=!0,p.flush()})),T.addEventListener("offline",(function(){p.areWeOnline=!1})))}return s(e,[{key:"retriableRequest",value:function(f){var p=this,v=f.retriesPerformedSoFar,_=a(f,ar);R(v)&&v>0&&(_.url=ir(_.url,{retry_count:v})),this.instance._send_request(t(t({},_),{},{callback:function(f){var g;200!==f.statusCode&&(f.statusCode<400||f.statusCode>=500)&&(null!=v?v:0)<10?p.enqueue(t({retriesPerformedSoFar:v},_)):null===(g=_.callback)||void 0===g||g.call(_,f)}}))}},{key:"enqueue",value:function(f){var p=f.retriesPerformedSoFar||0;f.retriesPerformedSoFar=p+1;var v=function(f){var p=3e3*Math.pow(2,f),v=p/2,_=Math.min(18e5,p),g=(Math.random()-.5)*(_-v);return Math.ceil(_+g)}(p),_=Date.now()+v;this.queue.push({retryAt:_,requestOptions:f});var g="Enqueued failed request for retry in ".concat(v);navigator.onLine||(g+=" (Browser is offline)"),W.warn(g),this.isPolling||(this.isPolling=!0,this.poll())}},{key:"poll",value:function(){var f=this;this.poller&&clearTimeout(this.poller),this.poller=setTimeout((function(){f.areWeOnline&&f.queue.length>0&&f.flush(),f.poll()}),this.pollIntervalMs)}},{key:"flush",value:function(){var f=Date.now(),p=[],v=this.queue.filter((function(v){return v.retryAt<f||(p.push(v),!1)}));if(this.queue=p,v.length>0){var _,g=h(v);try{for(g.s();!(_=g.n()).done;){var m=_.value.requestOptions;this.retriableRequest(m)}}catch(f){g.e(f)}finally{g.f()}}}},{key:"unload",value:function(){this.poller&&(clearTimeout(this.poller),this.poller=void 0);var f,p=h(this.queue);try{for(p.s();!(f=p.n()).done;){var v=f.value.requestOptions;try{this.instance._send_request(t(t({},v),{},{transport:"sendBeacon"}))}catch(f){W.error(f)}}}catch(f){p.e(f)}finally{p.f()}this.queue=[]}}]),e}(),cr=1800,dr=function(){function e(f,p,v,_){var g;i(this,e),o(this,"_sessionIdChangedHandlers",[]),this.config=f,this.persistence=p,this._windowId=void 0,this._sessionId=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this._sessionIdGenerator=v||Ke,this._windowIdGenerator=_||Ke;var m=f.persistence_name||f.token,T=f.session_idle_timeout_seconds||cr;if(R(T)?T>cr?W.warn("session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead."):T<60&&W.warn("session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead."):(W.warn("session_idle_timeout_seconds must be a number. Defaulting to 30 minutes."),T=cr),this._sessionTimeoutMs=1e3*Math.min(Math.max(T,60),cr),this._window_id_storage_key="ph_"+m+"_window_id",this._primary_window_exists_storage_key="ph_"+m+"_primary_window_exists",this._canUseSessionStorage()){var C=ft.parse(this._window_id_storage_key),$=ft.parse(this._primary_window_exists_storage_key);C&&!$?this._windowId=C:ft.remove(this._window_id_storage_key),ft.set(this._primary_window_exists_storage_key,!0)}if(null!==(g=this.config.bootstrap)&&void 0!==g&&g.sessionID)try{var O=function(f){var p=f.replace(/-/g,"");if(32!==p.length)throw new Error("Not a valid UUID");if("7"!==p[12])throw new Error("Not a UUIDv7");return parseInt(p.substring(0,12),16)}(this.config.bootstrap.sessionID);this._setSessionId(this.config.bootstrap.sessionID,(new Date).getTime(),O)}catch(f){W.error("Invalid sessionID in bootstrap",f)}this._listenToReloadWindow()}return s(e,[{key:"onSessionId",value:function(f){var p=this;return w(this._sessionIdChangedHandlers)&&(this._sessionIdChangedHandlers=[]),this._sessionIdChangedHandlers.push(f),this._sessionId&&f(this._sessionId,this._windowId),function(){p._sessionIdChangedHandlers=p._sessionIdChangedHandlers.filter((function(p){return p!==f}))}}},{key:"_canUseSessionStorage",value:function(){return"memory"!==this.config.persistence&&!this.persistence.disabled&&ft.is_supported()}},{key:"_setWindowId",value:function(f){f!==this._windowId&&(this._windowId=f,this._canUseSessionStorage()&&ft.set(this._window_id_storage_key,f))}},{key:"_getWindowId",value:function(){return this._windowId?this._windowId:this._canUseSessionStorage()?ft.parse(this._window_id_storage_key):null}},{key:"_setSessionId",value:function(f,p,v){f===this._sessionId&&p===this._sessionActivityTimestamp&&v===this._sessionStartTimestamp||(this._sessionStartTimestamp=v,this._sessionActivityTimestamp=p,this._sessionId=f,this.persistence.register(o({},Se,[p,f,v])))}},{key:"_getSessionId",value:function(){if(this._sessionId&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this._sessionId,this._sessionStartTimestamp];var f=this.persistence.props[Se];return m(f)&&2===f.length&&f.push(f[0]),f||[0,null,0]}},{key:"resetSessionId",value:function(){this._setSessionId(null,null,null)}},{key:"_listenToReloadWindow",value:function(){var f=this;null==T||T.addEventListener("beforeunload",(function(){f._canUseSessionStorage()&&ft.remove(f._primary_window_exists_storage_key)}))}},{key:"checkAndGetSessionAndWindowId",value:function(){var f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],p=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(new Date).getTime(),v=u(this._getSessionId(),3),_=v[0],g=v[1],m=v[2],T=this._getWindowId(),C=m&&m>0&&Math.abs(p-m)>864e5,$=!1,O=!g,M=!f&&Math.abs(p-_)>this._sessionTimeoutMs;O||M||C?(g=this._sessionIdGenerator(),T=this._windowIdGenerator(),W.info("[SessionId] new session ID generated",{sessionId:g,windowId:T,changeReason:{noSessionId:O,activityTimeout:M,sessionPastMaximumLength:C}}),m=p,$=!0):T||(T=this._windowIdGenerator(),$=!0);var A=0===_||!f||C?p:_,D=0===m?(new Date).getTime():m;return this._setWindowId(T),this._setSessionId(g,A,D),$&&this._sessionIdChangedHandlers.forEach((function(f){return f(g,T)})),{sessionId:g,windowId:T,sessionStartTimestamp:D}}}]),e}();!function(f){f.US="us",f.EU="eu",f.CUSTOM="custom"}(ur||(ur={}));var hr="i.posthog.com",fr=function(){function e(f){i(this,e),o(this,"_regionCache",{}),this.instance=f}return s(e,[{key:"apiHost",get:function(){return this.instance.config.api_host.trim().replace(/\/$/,"")}},{key:"uiHost",get:function(){var f,p=null===(f=this.instance.config.ui_host)||void 0===f?void 0:f.replace(/\/$/,"");return"https://app.posthog.com"===p?"https://us.posthog.com":p}},{key:"region",get:function(){return this._regionCache[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=ur.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=ur.EU:this._regionCache[this.apiHost]=ur.CUSTOM),this._regionCache[this.apiHost]}},{key:"endpointFor",value:function(f){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(p&&(p="/"===p[0]?p:"/".concat(p)),"ui"===f)return(this.uiHost||this.apiHost.replace(".".concat(hr),".posthog.com"))+p;if(this.region===ur.CUSTOM)return this.apiHost+p;var v=hr+p;switch(f){case"assets":return"https://".concat(this.region,"-assets.").concat(v);case"api":return"https://".concat(this.region,".").concat(v)}}},{key:"loadScript",value:function(f,p){if(this.instance.config.disable_external_dependency_loading)return W.warn("".concat(f," was requested but loading of external scripts is disabled.")),p("Loading of external scripts is disabled");var v="/"===f[0]?this.endpointFor("assets",f):f,i=function(){if(!D)return p("document not found");var f=D.createElement("script");f.type="text/javascript",f.src=v,f.onload=function(f){return p(void 0,f)},f.onerror=function(f){return p(f)};var _,g=D.querySelectorAll("body > script");g.length>0?null===(_=g[0].parentNode)||void 0===_||_.insertBefore(f,g[0]):D.body.appendChild(f)};null!=D&&D.body?i():null==D||D.addEventListener("DOMContentLoaded",i)}}]),e}(),pr="/e/",vr="[Exception Capture]",_r=function(){function e(f){var p,v,_=this;i(this,e),o(this,"originalOnUnhandledRejectionHandler",void 0),o(this,"startCapturing",(function(){var f;if(T&&_.isEnabled&&!_.hasHandlers&&(null===(f=T.onerror)||void 0===f||!f.__POSTHOG_INSTRUMENTED__)){var p=T.posthogErrorWrappingFunctions.wrapOnError,v=T.posthogErrorWrappingFunctions.wrapUnhandledRejection;if(p&&v)try{_.unwrapOnError=p(_.captureException.bind(_)),_.unwrapUnhandledRejection=v(_.captureException.bind(_))}catch(f){W.error(vr+" failed to start",f),_.stopCapturing()}else W.error(vr+" failed to load error wrapping functions - cannot start")}})),this.instance=f,this.remoteEnabled=!(null===(p=this.instance.persistence)||void 0===p||!p.props[pe]),this._endpoint=(null===(v=this.instance.persistence)||void 0===v?void 0:v.props[ve])||pr,this.startIfEnabled()}return s(e,[{key:"endpoint",get:function(){return this._endpoint}},{key:"isEnabled",get:function(){var f;return null!==(f=this.remoteEnabled)&&void 0!==f&&f}},{key:"isCapturing",get:function(){var f;return!(null==T||null===(f=T.onerror)||void 0===f||!f.__POSTHOG_INSTRUMENTED__)}},{key:"hasHandlers",get:function(){return this.originalOnUnhandledRejectionHandler||this.unwrapOnError}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this.isCapturing&&(W.info(vr+" enabled, starting..."),this.loadScript(this.startCapturing))}},{key:"loadScript",value:function(p){this.hasHandlers&&p(),this.instance.requestRouter.loadScript(this.instance.requestRouter.endpointFor("assets","/static/exception-autocapture.js?v=".concat(f.LIB_VERSION)),(function(f){f&&W.error(vr+" failed to load script",f),p()}))}},{key:"stopCapturing",value:function(){var f,p;null===(f=this.unwrapOnError)||void 0===f||f.call(this),null===(p=this.unwrapUnhandledRejection)||void 0===p||p.call(this)}},{key:"afterDecideResponse",value:function(f){var p=f.autocaptureExceptions;this.remoteEnabled=!!p||!1,this._endpoint=b(p)&&p.endpoint||pr,this.instance.persistence&&(this.instance.persistence.register(o({},pe,this.remoteEnabled)),this.instance.persistence.register(o({},ve,this._endpoint))),this.startIfEnabled()}},{key:"captureException",value:function(f){var p=this.instance.requestRouter.endpointFor("ui");f.$exception_personURL="".concat(p,"/project/").concat(this.instance.config.token,"/person/").concat(this.instance.get_distinct_id()),this.sendExceptionEvent(f)}},{key:"sendExceptionEvent",value:function(f){this.instance.capture("$exception",f,{_noTruncate:!0,_batchKey:"exceptionEvent",_url:this.endpoint})}}]),e}(),gr="posthog-js";function mr(f){var p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=p.organization,_=p.projectId,g=p.prefix,m=p.severityAllowList,T=void 0===m?["error"]:m;return function(p){var m,C,$,O,M,A;if(!("*"===T||T.includes(p.level))||!f.__loaded)return p;p.tags||(p.tags={});var D=f.requestRouter.endpointFor("ui","/project/".concat(f.config.token,"/person/").concat(f.get_distinct_id()));p.tags["PostHog Person URL"]=D,f.sessionRecordingStarted()&&(p.tags["PostHog Recording URL"]=f.get_session_replay_url({withTimestamp:!0}));var L=(null===(m=p.exception)||void 0===m?void 0:m.values)||[],N={$exception_message:(null===(C=L[0])||void 0===C?void 0:C.value)||p.message,$exception_type:null===($=L[0])||void 0===$?void 0:$.type,$exception_personURL:D,$exception_level:p.level,$sentry_event_id:p.event_id,$sentry_exception:p.exception,$sentry_exception_message:(null===(O=L[0])||void 0===O?void 0:O.value)||p.message,$sentry_exception_type:null===(M=L[0])||void 0===M?void 0:M.type,$sentry_tags:p.tags,$level:p.level};return v&&_&&(N.$sentry_url=(g||"https://sentry.io/organizations/")+v+"/issues/?project="+_+"&query="+p.event_id),f.capture("$exception",N,{_url:(null===(A=f.exceptionObserver)||void 0===A?void 0:A.endpoint)||pr}),p}}var yr=s((function e(f,p,v,_,g){i(this,e),this.name=gr,this.setupOnce=function(m){m(mr(f,{organization:p,projectId:v,prefix:_,severityAllowList:g}))}}));function br(f,p){var v=f.config.segment;if(!v)return p();!function(f,p){var v=f.config.segment;if(!v)return p();var i=function(v){var i=function(){return v.anonymousId()||Ke()};f.config.get_device_id=i,v.id()&&(f.register({distinct_id:v.id(),$device_id:i()}),f.persistence.set_property($e,"identified")),p()},_=v.user();"then"in _&&y(_.then)?_.then((function(f){return i(f)})):i(_)}(f,(function(){v.register(function(f){Promise&&Promise.resolve||W.warn("This browser does not have Promise support, and can not use the segment integration");var t=function(p,v){var _;if(!v)return p;p.event.userId||p.event.anonymousId===f.get_distinct_id()||f.reset(),p.event.userId&&p.event.userId!==f.get_distinct_id()&&(f.register({distinct_id:p.event.userId}),f.reloadFeatureFlags());var g=f._calculate_event_properties(v,null!==(_=p.event.properties)&&void 0!==_?_:{});return p.event.properties=Object.assign({},g,p.event.properties),p};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:function(f){return t(f,f.event.event)},page:function(f){return t(f,"$pageview")},identify:function(f){return t(f,"$identify")},screen:function(f){return t(f,"$screen")}}}(f)).then((function(){p()}))}))}var kr,wr,Sr,Er=function(){function e(f){i(this,e),this._instance=f}return s(e,[{key:"doPageView",value:function(){var f,p=this._previousScrollProperties();return this._currentPath=null!==(f=null==T?void 0:T.location.pathname)&&void 0!==f?f:"",this._instance.scrollManager.resetContext(),p}},{key:"doPageLeave",value:function(){return this._previousScrollProperties()}},{key:"_previousScrollProperties",value:function(){var f=this._currentPath,p=this._instance.scrollManager.getContext();if(!f||!p)return{};var v=p.maxScrollHeight,_=p.lastScrollY,g=p.maxScrollY,m=p.maxContentHeight,T=p.lastContentY,C=p.maxContentY;return w(v)||w(_)||w(g)||w(m)||w(T)||w(C)?{}:(v=Math.ceil(v),_=Math.ceil(_),g=Math.ceil(g),m=Math.ceil(m),T=Math.ceil(T),C=Math.ceil(C),{$prev_pageview_pathname:f,$prev_pageview_last_scroll:_,$prev_pageview_last_scroll_percentage:v<=1?1:Fr(_/v,0,1),$prev_pageview_max_scroll:g,$prev_pageview_max_scroll_percentage:v<=1?1:Fr(g/v,0,1),$prev_pageview_last_content:T,$prev_pageview_last_content_percentage:m<=1?1:Fr(T/m,0,1),$prev_pageview_max_content:C,$prev_pageview_max_content_percentage:m<=1?1:Fr(C/m,0,1)})}}]),e}();function Fr(f,p,v){return Math.max(p,Math.min(f,v))}!function(f){f.Popover="popover",f.API="api",f.Widget="widget"}(kr||(kr={})),function(f){f.Open="open",f.MultipleChoice="multiple_choice",f.SingleChoice="single_choice",f.Rating="rating",f.Link="link"}(wr||(wr={})),function(f){f.NextQuestion="next_question",f.End="end",f.ResponseBased="response_based",f.SpecificQuestion="specific_question"}(Sr||(Sr={}));var Ir=function(){function e(){i(this,e),o(this,"events",{}),this.events={}}return s(e,[{key:"on",value:function(f,p){var v=this;return this.events[f]||(this.events[f]=[]),this.events[f].push(p),function(){v.events[f]=v.events[f].filter((function(f){return f!==p}))}}},{key:"emit",value:function(f,p){var v,_=h(this.events[f]||[]);try{for(_.s();!(v=_.n()).done;)(0,v.value)(p)}catch(f){_.e(f)}finally{_.f()}var g,m=h(this.events["*"]||[]);try{for(m.s();!(g=m.n()).done;)(0,g.value)(f,p)}catch(f){m.e(f)}finally{m.f()}}}]),e}(),Rr=function(){function e(f){var p=this;i(this,e),o(this,"_debugEventEmitter",new Ir),o(this,"checkStep",(function(f,v){return p.checkStepEvent(f,v)&&p.checkStepUrl(f,v)&&p.checkStepElement(f,v)})),o(this,"checkStepEvent",(function(f,p){return null==p||!p.event||(null==f?void 0:f.event)===(null==p?void 0:p.event)})),this.instance=f,this.actionEvents=new Set,this.actionRegistry=new Set}return s(e,[{key:"init",value:function(){var f,p=this;if(!w(null===(f=this.instance)||void 0===f?void 0:f._addCaptureHook)){var v;null===(v=this.instance)||void 0===v||v._addCaptureHook((function(f,v){p.on(f,v)}))}}},{key:"register",value:function(f){var p,v,_=this;if(!w(null===(p=this.instance)||void 0===p?void 0:p._addCaptureHook)&&(f.forEach((function(f){var p,v;null===(p=_.actionRegistry)||void 0===p||p.add(f),null===(v=f.steps)||void 0===v||v.forEach((function(f){var p;null===(p=_.actionEvents)||void 0===p||p.add((null==f?void 0:f.event)||"")}))})),null!==(v=this.instance)&&void 0!==v&&v.autocapture)){var g,m=new Set;f.forEach((function(f){var p;null===(p=f.steps)||void 0===p||p.forEach((function(f){null!=f&&f.selector&&m.add(null==f?void 0:f.selector)}))})),null===(g=this.instance)||void 0===g||g.autocapture.setElementSelectors(m)}}},{key:"on",value:function(f,p){var v,_=this;null!=p&&0!=f.length&&(this.actionEvents.has(f)||this.actionEvents.has(null==p?void 0:p.event))&&this.actionRegistry&&(null===(v=this.actionRegistry)||void 0===v?void 0:v.size)>0&&this.actionRegistry.forEach((function(f){_.checkAction(p,f)&&_._debugEventEmitter.emit("actionCaptured",f.name)}))}},{key:"_addActionHook",value:function(f){this.onAction("actionCaptured",(function(p){return f(p)}))}},{key:"checkAction",value:function(f,p){if(null==(null==p?void 0:p.steps))return!1;var v,_=h(p.steps);try{for(_.s();!(v=_.n()).done;){var g=v.value;if(this.checkStep(f,g))return!0}}catch(f){_.e(f)}finally{_.f()}return!1}},{key:"onAction",value:function(f,p){return this._debugEventEmitter.on(f,p)}},{key:"checkStepUrl",value:function(f,p){if(null!=p&&p.url){var v,_=null==f||null===(v=f.properties)||void 0===v?void 0:v.$current_url;if(!_||"string"!=typeof _)return!1;if(!e.matchString(_,null==p?void 0:p.url,(null==p?void 0:p.url_matching)||"contains"))return!1}return!0}},{key:"checkStepElement",value:function(f,p){if((null!=p&&p.href||null!=p&&p.tag_name||null!=p&&p.text)&&!this.getElementsList(f).some((function(f){return!(null!=p&&p.href&&!e.matchString(f.href||"",null==p?void 0:p.href,(null==p?void 0:p.href_matching)||"exact"))&&(null==p||!p.tag_name||f.tag_name===(null==p?void 0:p.tag_name))&&!(null!=p&&p.text&&!e.matchString(f.text||"",null==p?void 0:p.text,(null==p?void 0:p.text_matching)||"exact")&&!e.matchString(f.$el_text||"",null==p?void 0:p.text,(null==p?void 0:p.text_matching)||"exact"))})))return!1;if(null!=p&&p.selector){var v,_=null==f||null===(v=f.properties)||void 0===v?void 0:v.$element_selectors;if(!_)return!1;if(!_.includes(null==p?void 0:p.selector))return!1}return!0}},{key:"getElementsList",value:function(f){return null==(null==f?void 0:f.properties.$elements)?[]:null==f?void 0:f.properties.$elements}}],[{key:"matchString",value:function(f,p,v){switch(v){case"regex":return!!T&&_t(f,p);case"exact":return p===f;case"contains":var _=e.escapeStringRegexp(p).replace(/_/g,".").replace(/%/g,".*");return _t(f,_);default:return!1}}},{key:"escapeStringRegexp",value:function(f){return f.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}]),e}(),xr=function(){function e(f){i(this,e),this.instance=f,this.eventToSurveys=new Map,this.actionToSurveys=new Map}return s(e,[{key:"register",value:function(f){var p;w(null===(p=this.instance)||void 0===p?void 0:p._addCaptureHook)||(this.setupEventBasedSurveys(f),this.setupActionBasedSurveys(f))}},{key:"setupActionBasedSurveys",value:function(f){var p=this,v=f.filter((function(f){var p,v,_,g;return(null===(p=f.conditions)||void 0===p?void 0:p.actions)&&(null===(v=f.conditions)||void 0===v||null===(_=v.actions)||void 0===_||null===(g=_.values)||void 0===g?void 0:g.length)>0}));if(0!==v.length){if(null==this.actionMatcher){this.actionMatcher=new Rr(this.instance),this.actionMatcher.init();this.actionMatcher._addActionHook((function(f){p.onAction(f)}))}v.forEach((function(f){var v,_,g,m,T,C,$,O,M,A;f.conditions&&null!==(v=f.conditions)&&void 0!==v&&v.actions&&null!==(_=f.conditions)&&void 0!==_&&null!==(g=_.actions)&&void 0!==g&&g.values&&(null===(m=f.conditions)||void 0===m||null===(T=m.actions)||void 0===T||null===(C=T.values)||void 0===C?void 0:C.length)>0&&(null===($=p.actionMatcher)||void 0===$||$.register(f.conditions.actions.values),null===(O=f.conditions)||void 0===O||null===(M=O.actions)||void 0===M||null===(A=M.values)||void 0===A||A.forEach((function(v){if(v&&v.name){var _=p.actionToSurveys.get(v.name);_&&_.push(f.id),p.actionToSurveys.set(v.name,_||[f.id])}})))}))}}},{key:"setupEventBasedSurveys",value:function(f){var p,v=this;0!==f.filter((function(f){var p,v,_,g;return(null===(p=f.conditions)||void 0===p?void 0:p.events)&&(null===(v=f.conditions)||void 0===v||null===(_=v.events)||void 0===_||null===(g=_.values)||void 0===g?void 0:g.length)>0})).length&&(null===(p=this.instance)||void 0===p||p._addCaptureHook((function(f){v.onEvent(f)})),f.forEach((function(f){var p,_,g;null===(p=f.conditions)||void 0===p||null===(_=p.events)||void 0===_||null===(g=_.values)||void 0===g||g.forEach((function(p){if(p&&p.name){var _=v.eventToSurveys.get(p.name);_&&_.push(f.id),v.eventToSurveys.set(p.name,_||[f.id])}}))})))}},{key:"onEvent",value:function(f,p){var v,_,g=(null===(v=this.instance)||void 0===v||null===(_=v.persistence)||void 0===_?void 0:_.props[Te])||[];if(e.SURVEY_SHOWN_EVENT_NAME==f&&p&&g.length>0){var m,T=null==p||null===(m=p.properties)||void 0===m?void 0:m.$survey_id;if(T){var C=g.indexOf(T);C>=0&&(g.splice(C,1),this._updateActivatedSurveys(g))}}else this.eventToSurveys.has(f)&&this._updateActivatedSurveys(g.concat(this.eventToSurveys.get(f)||[]))}},{key:"onAction",value:function(f){var p,v,_=(null===(p=this.instance)||void 0===p||null===(v=p.persistence)||void 0===v?void 0:v.props[Te])||[];this.actionToSurveys.has(f)&&this._updateActivatedSurveys(_.concat(this.actionToSurveys.get(f)||[]))}},{key:"_updateActivatedSurveys",value:function(f){var p,v;null===(p=this.instance)||void 0===p||null===(v=p.persistence)||void 0===v||v.register(o({},Te,l(new Set(f))))}},{key:"getSurveys",value:function(){var f,p,v=null===(f=this.instance)||void 0===f||null===(p=f.persistence)||void 0===p?void 0:p.props[Te];return v||[]}},{key:"getEventToSurveys",value:function(){return this.eventToSurveys}},{key:"_getActionMatcher",value:function(){return this.actionMatcher}}]),e}();o(xr,"SURVEY_SHOWN_EVENT_NAME","survey shown");var Pr,Tr,Cr,$r,Or,Mr,Ar,Dr,Lr={},Nr=[],qr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Br=Array.isArray;function Hr(f,p){for(var v in p)f[v]=p[v];return f}function Ur(f){var p=f.parentNode;p&&p.removeChild(f)}function jr(f,p,v,_,g){var m={type:f,props:p,key:v,ref:_,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==g?++Cr:g,__i:-1,__u:0};return null==g&&null!=Tr.vnode&&Tr.vnode(m),m}function Wr(f){return f.children}function Gr(f,p){this.props=f,this.context=p}function zr(f,p){if(null==p)return f.__?zr(f.__,f.__i+1):null;for(var v;p<f.__k.length;p++)if(null!=(v=f.__k[p])&&null!=v.__e)return v.__e;return"function"==typeof f.type?zr(f):null}function Vr(f){var p,v;if(null!=(f=f.__)&&null!=f.__c){for(f.__e=f.__c.base=null,p=0;p<f.__k.length;p++)if(null!=(v=f.__k[p])&&null!=v.__e){f.__e=f.__c.base=v.__e;break}return Vr(f)}}function Qr(f){(!f.__d&&(f.__d=!0)&&$r.push(f)&&!Jr.__r++||Or!==Tr.debounceRendering)&&((Or=Tr.debounceRendering)||Mr)(Jr)}function Jr(){var f,p,v,_,g,m,T,C,$;for($r.sort(Ar);f=$r.shift();)f.__d&&(p=$r.length,_=void 0,m=(g=(v=f).__v).__e,C=[],$=[],(T=v.__P)&&((_=Hr({},g)).__v=g.__v+1,Tr.vnode&&Tr.vnode(_),rs(T,_,g,v.__n,void 0!==T.ownerSVGElement,32&g.__u?[m]:null,C,null==m?zr(g):m,!!(32&g.__u),$),_.__.__k[_.__i]=_,ss(C,_,$),_.__e!=m&&Vr(_)),$r.length>p&&$r.sort(Ar));Jr.__r=0}function Yr(f,p,v,_,g,m,T,C,$,O,M){var A,D,L,N,q,B=_&&_.__k||Nr,H=p.length;for(v.__d=$,Xr(v,p,B),$=v.__d,A=0;A<H;A++)null!=(L=v.__k[A])&&"boolean"!=typeof L&&"function"!=typeof L&&(D=-1===L.__i?Lr:B[L.__i]||Lr,L.__i=A,rs(f,L,D,g,m,T,C,$,O,M),N=L.__e,L.ref&&D.ref!=L.ref&&(D.ref&&as(D.ref,null,L),M.push(L.ref,L.__c||N,L)),null==q&&null!=N&&(q=N),65536&L.__u||D.__k===L.__k?$=Kr(L,$,f):"function"==typeof L.type&&void 0!==L.__d?$=L.__d:N&&($=N.nextSibling),L.__d=void 0,L.__u&=-196609);v.__d=$,v.__e=q}function Xr(f,p,v){var _,g,m,T,C,$=p.length,O=v.length,M=O,A=0;for(f.__k=[],_=0;_<$;_++)null!=(g=f.__k[_]=null==(g=p[_])||"boolean"==typeof g||"function"==typeof g?null:"string"==typeof g||"number"==typeof g||"bigint"==typeof g||g.constructor==String?jr(null,g,null,null,g):Br(g)?jr(Wr,{children:g},null,null,null):void 0===g.constructor&&g.__b>0?jr(g.type,g.props,g.key,g.ref?g.ref:null,g.__v):g)?(g.__=f,g.__b=f.__b+1,C=Zr(g,v,T=_+A,M),g.__i=C,m=null,-1!==C&&(M--,(m=v[C])&&(m.__u|=131072)),null==m||null===m.__v?(-1==C&&A--,"function"!=typeof g.type&&(g.__u|=65536)):C!==T&&(C===T+1?A++:C>T?M>$-T?A+=C-T:A--:A=C<T&&C==T-1?C-T:0,C!==_+A&&(g.__u|=65536))):(m=v[_])&&null==m.key&&m.__e&&(m.__e==f.__d&&(f.__d=zr(m)),us(m,m,!1),v[_]=null,M--);if(M)for(_=0;_<O;_++)null!=(m=v[_])&&0==(131072&m.__u)&&(m.__e==f.__d&&(f.__d=zr(m)),us(m,m))}function Kr(f,p,v){var _,g;if("function"==typeof f.type){for(_=f.__k,g=0;_&&g<_.length;g++)_[g]&&(_[g].__=f,p=Kr(_[g],p,v));return p}return f.__e!=p&&(v.insertBefore(f.__e,p||null),p=f.__e),p&&p.nextSibling}function Zr(f,p,v,_){var g=f.key,m=f.type,T=v-1,C=v+1,$=p[v];if(null===$||$&&g==$.key&&m===$.type)return v;if(_>(null!=$&&0==(131072&$.__u)?1:0))for(;T>=0||C<p.length;){if(T>=0){if(($=p[T])&&0==(131072&$.__u)&&g==$.key&&m===$.type)return T;T--}if(C<p.length){if(($=p[C])&&0==(131072&$.__u)&&g==$.key&&m===$.type)return C;C++}}return-1}function es(f,p,v){"-"===p[0]?f.setProperty(p,null==v?"":v):f[p]=null==v?"":"number"!=typeof v||qr.test(p)?v:v+"px"}function ts(f,p,v,_,g){var m;e:if("style"===p)if("string"==typeof v)f.style.cssText=v;else{if("string"==typeof _&&(f.style.cssText=_=""),_)for(p in _)v&&p in v||es(f.style,p,"");if(v)for(p in v)_&&v[p]===_[p]||es(f.style,p,v[p])}else if("o"===p[0]&&"n"===p[1])m=p!==(p=p.replace(/(PointerCapture)$|Capture$/,"$1")),p=p.toLowerCase()in f?p.toLowerCase().slice(2):p.slice(2),f.l||(f.l={}),f.l[p+m]=v,v?_?v.u=_.u:(v.u=Date.now(),f.addEventListener(p,m?is:ns,m)):f.removeEventListener(p,m?is:ns,m);else{if(g)p=p.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==p&&"height"!==p&&"href"!==p&&"list"!==p&&"form"!==p&&"tabIndex"!==p&&"download"!==p&&"rowSpan"!==p&&"colSpan"!==p&&"role"!==p&&p in f)try{f[p]=null==v?"":v;break e}catch(f){}"function"==typeof v||(null==v||!1===v&&"-"!==p[4]?f.removeAttribute(p):f.setAttribute(p,v))}}function ns(f){var p=this.l[f.type+!1];if(f.t){if(f.t<=p.u)return}else f.t=Date.now();return p(Tr.event?Tr.event(f):f)}function is(f){return this.l[f.type+!0](Tr.event?Tr.event(f):f)}function rs(f,p,v,_,g,m,T,C,$,O){var M,A,D,L,N,q,B,H,U,j,W,G,re,oe,ue,le=p.type;if(void 0!==p.constructor)return null;128&v.__u&&($=!!(32&v.__u),m=[C=p.__e=v.__e]),(M=Tr.__b)&&M(p);e:if("function"==typeof le)try{if(H=p.props,U=(M=le.contextType)&&_[M.__c],j=M?U?U.props.value:M.__:_,v.__c?B=(A=p.__c=v.__c).__=A.__E:("prototype"in le&&le.prototype.render?p.__c=A=new le(H,j):(p.__c=A=new Gr(H,j),A.constructor=le,A.render=ls),U&&U.sub(A),A.props=H,A.state||(A.state={}),A.context=j,A.__n=_,D=A.__d=!0,A.__h=[],A._sb=[]),null==A.__s&&(A.__s=A.state),null!=le.getDerivedStateFromProps&&(A.__s==A.state&&(A.__s=Hr({},A.__s)),Hr(A.__s,le.getDerivedStateFromProps(H,A.__s))),L=A.props,N=A.state,A.__v=p,D)null==le.getDerivedStateFromProps&&null!=A.componentWillMount&&A.componentWillMount(),null!=A.componentDidMount&&A.__h.push(A.componentDidMount);else{if(null==le.getDerivedStateFromProps&&H!==L&&null!=A.componentWillReceiveProps&&A.componentWillReceiveProps(H,j),!A.__e&&(null!=A.shouldComponentUpdate&&!1===A.shouldComponentUpdate(H,A.__s,j)||p.__v===v.__v)){for(p.__v!==v.__v&&(A.props=H,A.state=A.__s,A.__d=!1),p.__e=v.__e,p.__k=v.__k,p.__k.forEach((function(f){f&&(f.__=p)})),W=0;W<A._sb.length;W++)A.__h.push(A._sb[W]);A._sb=[],A.__h.length&&T.push(A);break e}null!=A.componentWillUpdate&&A.componentWillUpdate(H,A.__s,j),null!=A.componentDidUpdate&&A.__h.push((function(){A.componentDidUpdate(L,N,q)}))}if(A.context=j,A.props=H,A.__P=f,A.__e=!1,G=Tr.__r,re=0,"prototype"in le&&le.prototype.render){for(A.state=A.__s,A.__d=!1,G&&G(p),M=A.render(A.props,A.state,A.context),oe=0;oe<A._sb.length;oe++)A.__h.push(A._sb[oe]);A._sb=[]}else do{A.__d=!1,G&&G(p),M=A.render(A.props,A.state,A.context),A.state=A.__s}while(A.__d&&++re<25);A.state=A.__s,null!=A.getChildContext&&(_=Hr(Hr({},_),A.getChildContext())),D||null==A.getSnapshotBeforeUpdate||(q=A.getSnapshotBeforeUpdate(L,N)),Yr(f,Br(ue=null!=M&&M.type===Wr&&null==M.key?M.props.children:M)?ue:[ue],p,v,_,g,m,T,C,$,O),A.base=p.__e,p.__u&=-161,A.__h.length&&T.push(A),B&&(A.__E=A.__=null)}catch(f){p.__v=null,$||null!=m?(p.__e=C,p.__u|=$?160:32,m[m.indexOf(C)]=null):(p.__e=v.__e,p.__k=v.__k),Tr.__e(f,p,v)}else null==m&&p.__v===v.__v?(p.__k=v.__k,p.__e=v.__e):p.__e=os(v.__e,p,v,_,g,m,T,$,O);(M=Tr.diffed)&&M(p)}function ss(f,p,v){p.__d=void 0;for(var _=0;_<v.length;_++)as(v[_],v[++_],v[++_]);Tr.__c&&Tr.__c(p,f),f.some((function(p){try{f=p.__h,p.__h=[],f.some((function(f){f.call(p)}))}catch(f){Tr.__e(f,p.__v)}}))}function os(f,p,v,_,g,m,T,C,$){var O,M,A,D,L,N,q,B=v.props,H=p.props,U=p.type;if("svg"===U&&(g=!0),null!=m)for(O=0;O<m.length;O++)if((L=m[O])&&"setAttribute"in L==!!U&&(U?L.localName===U:3===L.nodeType)){f=L,m[O]=null;break}if(null==f){if(null===U)return document.createTextNode(H);f=g?document.createElementNS("http://www.w3.org/2000/svg",U):document.createElement(U,H.is&&H),m=null,C=!1}if(null===U)B===H||C&&f.data===H||(f.data=H);else{if(m=m&&Pr.call(f.childNodes),B=v.props||Lr,!C&&null!=m)for(B={},O=0;O<f.attributes.length;O++)B[(L=f.attributes[O]).name]=L.value;for(O in B)L=B[O],"children"==O||("dangerouslySetInnerHTML"==O?A=L:"key"===O||O in H||ts(f,O,null,L,g));for(O in H)L=H[O],"children"==O?D=L:"dangerouslySetInnerHTML"==O?M=L:"value"==O?N=L:"checked"==O?q=L:"key"===O||C&&"function"!=typeof L||B[O]===L||ts(f,O,L,B[O],g);if(M)C||A&&(M.__html===A.__html||M.__html===f.innerHTML)||(f.innerHTML=M.__html),p.__k=[];else if(A&&(f.innerHTML=""),Yr(f,Br(D)?D:[D],p,v,_,g&&"foreignObject"!==U,m,T,m?m[0]:v.__k&&zr(v,0),C,$),null!=m)for(O=m.length;O--;)null!=m[O]&&Ur(m[O]);C||(O="value",void 0!==N&&(N!==f[O]||"progress"===U&&!N||"option"===U&&N!==B[O])&&ts(f,O,N,B[O],!1),O="checked",void 0!==q&&q!==f[O]&&ts(f,O,q,B[O],!1))}return f}function as(f,p,v){try{"function"==typeof f?f(p):f.current=p}catch(f){Tr.__e(f,v)}}function us(f,p,v){var _,g;if(Tr.unmount&&Tr.unmount(f),(_=f.ref)&&(_.current&&_.current!==f.__e||as(_,null,p)),null!=(_=f.__c)){if(_.componentWillUnmount)try{_.componentWillUnmount()}catch(f){Tr.__e(f,p)}_.base=_.__P=null,f.__c=void 0}if(_=f.__k)for(g=0;g<_.length;g++)_[g]&&us(_[g],p,v||"function"!=typeof f.type);v||null==f.__e||Ur(f.__e),f.__=f.__e=f.__d=void 0}function ls(f,p,v){return this.constructor(f,v)}Pr=Nr.slice,Tr={__e:function(f,p,v,_){for(var g,m,T;p=p.__;)if((g=p.__c)&&!g.__)try{if((m=g.constructor)&&null!=m.getDerivedStateFromError&&(g.setState(m.getDerivedStateFromError(f)),T=g.__d),null!=g.componentDidCatch&&(g.componentDidCatch(f,_||{}),T=g.__d),T)return g.__E=g}catch(p){f=p}throw f}},Cr=0,Gr.prototype.setState=function(f,p){var v;v=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=Hr({},this.state),"function"==typeof f&&(f=f(Hr({},v),this.props)),f&&Hr(v,f),null!=f&&this.__v&&(p&&this._sb.push(p),Qr(this))},Gr.prototype.forceUpdate=function(f){this.__v&&(this.__e=!0,f&&this.__h.push(f),Qr(this))},Gr.prototype.render=Wr,$r=[],Mr="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ar=function(f,p){return f.__v.__b-p.__v.__b},Jr.__r=0,Dr=0;var cs=function(f){var p,v;return!(null===(p=f.conditions)||void 0===p||null===(v=p.events)||void 0===v||!v.repeatedActivation||!function(f){var p,v,_,g,m,T;return null!=(null===(p=f.conditions)||void 0===p||null===(v=p.events)||void 0===v||null===(_=v.values)||void 0===_?void 0:_.length)&&(null===(g=f.conditions)||void 0===g||null===(m=g.events)||void 0===m||null===(T=m.values)||void 0===T?void 0:T.length)>0}(f))};!function(f,p){var v={__c:p="__cC"+Dr++,__:f,Consumer:function(f,p){return f.children(p)},Provider:function(f){var v,_;return this.getChildContext||(v=[],(_={})[p]=this,this.getChildContext=function(){return _},this.shouldComponentUpdate=function(f){this.props.value!==f.value&&v.some((function(f){f.__e=!0,Qr(f)}))},this.sub=function(f){v.push(f);var p=f.componentWillUnmount;f.componentWillUnmount=function(){v.splice(v.indexOf(f),1),p&&p.call(f)}}),f.children}};v.Provider.__=v.Consumer.contextType=v}({isPreviewMode:!1,previewPageIndex:0,handleCloseSurveyPopup:function(){}});var ds={icontains:function(f){return!!T&&T.location.href.toLowerCase().indexOf(f.toLowerCase())>-1},not_icontains:function(f){return!!T&&-1===T.location.href.toLowerCase().indexOf(f.toLowerCase())},regex:function(f){return!!T&&_t(T.location.href,f)},not_regex:function(f){return!!T&&!_t(T.location.href,f)},exact:function(f){return(null==T?void 0:T.location.href)===f},is_not:function(f){return(null==T?void 0:T.location.href)!==f}};var hs=function(){function e(f){i(this,e),this.instance=f,this._surveyEventReceiver=null}return s(e,[{key:"afterDecideResponse",value:function(f){this._decideServerResponse=!!f.surveys,this.loadIfEnabled()}},{key:"loadIfEnabled",value:function(){var f=this,p=null==U?void 0:U.extendPostHogWithSurveys;this.instance.config.disable_surveys||!this._decideServerResponse||p||(null==this._surveyEventReceiver&&(this._surveyEventReceiver=new xr(this.instance)),this.instance.requestRouter.loadScript("/static/surveys.js",(function(p){if(p)return W.error("Could not load surveys script",p);U.extendPostHogWithSurveys(f.instance)})))}},{key:"getSurveys",value:function(f){var p=this,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.instance.config.disable_surveys)return f([]);null==this._surveyEventReceiver&&(this._surveyEventReceiver=new xr(this.instance));var _=this.instance.get_property(Pe);if(_&&!v)return f(_);this.instance._send_request({url:this.instance.requestRouter.endpointFor("api","/api/surveys/?token=".concat(this.instance.config.token)),method:"GET",transport:"XHR",callback:function(v){var _;if(200!==v.statusCode||!v.json)return f([]);var g,m=v.json.surveys||[],T=m.filter((function(f){var p,v,_,g,m,T,C,$,O,M,A,D;return(null===(p=f.conditions)||void 0===p?void 0:p.events)&&(null===(v=f.conditions)||void 0===v||null===(_=v.events)||void 0===_?void 0:_.values)&&(null===(g=f.conditions)||void 0===g||null===(m=g.events)||void 0===m||null===(T=m.values)||void 0===T?void 0:T.length)>0||(null===(C=f.conditions)||void 0===C?void 0:C.actions)&&(null===($=f.conditions)||void 0===$||null===(O=$.actions)||void 0===O?void 0:O.values)&&(null===(M=f.conditions)||void 0===M||null===(A=M.actions)||void 0===A||null===(D=A.values)||void 0===D?void 0:D.length)>0}));T.length>0&&(null===(g=p._surveyEventReceiver)||void 0===g||g.register(T));return null===(_=p.instance.persistence)||void 0===_||_.register(o({},Pe,m)),f(m)}})}},{key:"getActiveMatchingSurveys",value:function(f){var p=this,v=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getSurveys((function(v){var _,g=v.filter((function(f){return!(!f.start_date||f.end_date)})).filter((function(f){var p,v,_,g;if(!f.conditions)return!0;var m=null===(p=f.conditions)||void 0===p||!p.url||ds[null!==(v=null===(_=f.conditions)||void 0===_?void 0:_.urlMatchType)&&void 0!==v?v:"icontains"](f.conditions.url),T=null===(g=f.conditions)||void 0===g||!g.selector||(null==D?void 0:D.querySelector(f.conditions.selector));return m&&T})),m=null===(_=p._surveyEventReceiver)||void 0===_?void 0:_.getSurveys(),T=g.filter((function(f){var v,_,g,T,C,$,O,M,A,D;if(!f.linked_flag_key&&!f.targeting_flag_key&&!f.internal_targeting_flag_key)return!0;var L=!f.linked_flag_key||p.instance.featureFlags.isFeatureEnabled(f.linked_flag_key),N=!f.targeting_flag_key||p.instance.featureFlags.isFeatureEnabled(f.targeting_flag_key),q=(null===(v=f.conditions)||void 0===v?void 0:v.events)&&(null===(_=f.conditions)||void 0===_||null===(g=_.events)||void 0===g?void 0:g.values)&&(null===(T=f.conditions)||void 0===T||null===(C=T.events)||void 0===C?void 0:C.values.length)>0,B=(null===($=f.conditions)||void 0===$?void 0:$.actions)&&(null===(O=f.conditions)||void 0===O||null===(M=O.actions)||void 0===M?void 0:M.values)&&(null===(A=f.conditions)||void 0===A||null===(D=A.actions)||void 0===D?void 0:D.values.length)>0,H=!q&&!B||(null==m?void 0:m.includes(f.id)),U=cs(f),j=!(f.internal_targeting_flag_key&&!U)||p.instance.featureFlags.isFeatureEnabled(f.internal_targeting_flag_key);return L&&N&&j&&H}));return f(T)}),v)}},{key:"getNextSurveyStep",value:function(f,p,v){var _,g=f.questions[p],m=p+1;if(null===(_=g.branching)||void 0===_||!_.type)return p===f.questions.length-1?Sr.End:m;if(g.branching.type===Sr.End)return Sr.End;if(g.branching.type===Sr.SpecificQuestion){if(Number.isInteger(g.branching.index))return g.branching.index}else if(g.branching.type===Sr.ResponseBased){if(g.type===wr.SingleChoice){var T,C,$=g.choices.indexOf("".concat(v));if(null!==(T=g.branching)&&void 0!==T&&null!==(C=T.responseValues)&&void 0!==C&&C.hasOwnProperty($)){var O=g.branching.responseValues[$];return Number.isInteger(O)?O:O===Sr.End?Sr.End:m}}else if(g.type===wr.Rating){var M,A;if("number"!=typeof v||!Number.isInteger(v))throw new Error("The response type must be an integer");var D=function(f,p){if(3===p){if(f<1||f>3)throw new Error("The response must be in range 1-3");return 1===f?"negative":2===f?"neutral":"positive"}if(5===p){if(f<1||f>5)throw new Error("The response must be in range 1-5");return f<=2?"negative":3===f?"neutral":"positive"}if(10===p){if(f<0||f>10)throw new Error("The response must be in range 0-10");return f<=6?"detractors":f<=8?"passives":"promoters"}throw new Error("The scale must be one of: 3, 5, 10")}(v,g.scale);if(null!==(M=g.branching)&&void 0!==M&&null!==(A=M.responseValues)&&void 0!==A&&A.hasOwnProperty(D)){var L=g.branching.responseValues[D];return Number.isInteger(L)?L:L===Sr.End?Sr.End:m}}return m}return console.warn("Falling back to next question index due to unexpected branching type"),m}}]),e}(),fs=function(){function e(f){var p,v,_=this;i(this,e),o(this,"serverLimits",{}),o(this,"lastEventRateLimited",!1),o(this,"checkForLimiting",(function(f){var p=f.text;if(p&&p.length)try{(JSON.parse(p).quota_limited||[]).forEach((function(f){W.info("[RateLimiter] ".concat(f||"events"," is quota limited.")),_.serverLimits[f]=(new Date).getTime()+6e4}))}catch(f){return void W.warn('[RateLimiter] could not rate limit - continuing. Error: "'.concat(null==f?void 0:f.message,'"'),{text:p})}})),this.instance=f,this.captureEventsPerSecond=(null===(p=f.config.rate_limiting)||void 0===p?void 0:p.events_per_second)||10,this.captureEventsBurstLimit=Math.max((null===(v=f.config.rate_limiting)||void 0===v?void 0:v.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}return s(e,[{key:"clientRateLimitContext",value:function(){var f,p,v,_=arguments.length>0&&void 0!==arguments[0]&&arguments[0],g=(new Date).getTime(),m=null!==(f=null===(p=this.instance.persistence)||void 0===p?void 0:p.get_property(Me))&&void 0!==f?f:{tokens:this.captureEventsBurstLimit,last:g};m.tokens+=(g-m.last)/1e3*this.captureEventsPerSecond,m.last=g,m.tokens>this.captureEventsBurstLimit&&(m.tokens=this.captureEventsBurstLimit);var T=m.tokens<1;return T||_||(m.tokens=Math.max(0,m.tokens-1)),!T||this.lastEventRateLimited||_||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to ".concat(this.captureEventsPerSecond," events per second and ").concat(this.captureEventsBurstLimit," events burst limit.")},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=T,null===(v=this.instance.persistence)||void 0===v||v.set_property(Me,m),{isRateLimited:T,remainingTokens:m.tokens}}},{key:"isServerRateLimited",value:function(f){var p=this.serverLimits[f||"events"]||!1;return!1!==p&&(new Date).getTime()<p}}]),e}(),ps=function(){return t({initialPathName:(null==L?void 0:L.pathname)||"",referringDomain:mn.referringDomain()},mn.campaignParams())},vs=function(){function e(f,p,v){var _=this;i(this,e),o(this,"_onSessionIdCallback",(function(f){var p=_._getStoredProps();if(!p||p.sessionId!==f){var v={sessionId:f,props:_._sessionSourceParamGenerator()};_._persistence.register(o({},Oe,v))}})),this._sessionIdManager=f,this._persistence=p,this._sessionSourceParamGenerator=v||ps,this._sessionIdManager.onSessionId(this._onSessionIdCallback)}return s(e,[{key:"_getStoredProps",value:function(){return this._persistence.props[Oe]}},{key:"getSessionProps",value:function(){var f,p=null===(f=this._getStoredProps())||void 0===f?void 0:f.props;return p?{$client_session_initial_referring_host:p.referringDomain,$client_session_initial_pathname:p.initialPathName,$client_session_initial_utm_source:p.utm_source,$client_session_initial_utm_campaign:p.utm_campaign,$client_session_initial_utm_medium:p.utm_medium,$client_session_initial_utm_content:p.utm_content,$client_session_initial_utm_term:p.utm_term}:{}}}]),e}(),_s=["ahrefsbot","ahrefssiteaudit","applebot","baiduspider","bingbot","bingpreview","bot.htm","bot.php","crawler","deepscan","duckduckbot","facebookexternal","facebookcatalog","gptbot","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","semrushbot","sitebulb","slurp","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","Google-HotelAdsVerifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","Bytespider;"],gs=function(f,p){if(!f)return!1;var v=f.toLowerCase();return _s.concat(p||[]).some((function(f){var p=f.toLowerCase();return-1!==v.indexOf(p)}))},ms=function(){function e(){i(this,e),this.clicks=[]}return s(e,[{key:"isRageClick",value:function(f,p,v){var _=this.clicks[this.clicks.length-1];if(_&&Math.abs(f-_.x)+Math.abs(p-_.y)<30&&v-_.timestamp<1e3){if(this.clicks.push({x:f,y:p,timestamp:v}),3===this.clicks.length)return!0}else this.clicks=[{x:f,y:p,timestamp:v}];return!1}}]),e}();function ys(f){var p;return f.id===qe||!(null===(p=f.closest)||void 0===p||!p.call(f,"#"+qe))}var bs=function(){function e(f){var p,v=this;i(this,e),o(this,"rageclicks",new ms),o(this,"_enabledServerSide",!1),o(this,"_initialized",!1),o(this,"_flushInterval",null),this.instance=f,this._enabledServerSide=!(null===(p=this.instance.persistence)||void 0===p||!p.props[fe]),null==T||T.addEventListener("beforeunload",(function(){v.flush()}))}return s(e,[{key:"flushIntervalMilliseconds",get:function(){var f=5e3;return b(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(f=this.instance.config.capture_heatmaps.flush_interval_milliseconds),f}},{key:"isEnabled",get:function(){return w(this.instance.config.capture_heatmaps)?w(this.instance.config.enable_heatmaps)?this._enabledServerSide:this.instance.config.enable_heatmaps:!1!==this.instance.config.capture_heatmaps}},{key:"startIfEnabled",value:function(){if(this.isEnabled){if(this._initialized)return;W.info("[heatmaps] starting..."),this._setupListeners(),this._flushInterval=setInterval(this.flush.bind(this),this.flushIntervalMilliseconds)}else{var f;clearInterval(null!==(f=this._flushInterval)&&void 0!==f?f:void 0),this.getAndClearBuffer()}}},{key:"afterDecideResponse",value:function(f){var p=!!f.heatmaps;this.instance.persistence&&this.instance.persistence.register(o({},fe,p)),this._enabledServerSide=p,this.startIfEnabled()}},{key:"getAndClearBuffer",value:function(){var f=this.buffer;return this.buffer=void 0,f}},{key:"_setupListeners",value:function(){var f=this;T&&D&&(oe(D,"click",(function(p){return f._onClick(p||(null==T?void 0:T.event))}),!1,!0),oe(D,"mousemove",(function(p){return f._onMouseMove(p||(null==T?void 0:T.event))}),!1,!0),this._initialized=!0)}},{key:"_getProperties",value:function(f,p){var v=this.instance.scrollManager.scrollY(),_=this.instance.scrollManager.scrollX(),g=this.instance.scrollManager.scrollElement(),m=function(f,p,v){for(var _=f;_&&!On(_,"body");){if(_===v)return!1;if(Y(p,null==T?void 0:T.getComputedStyle(_).position))return!0;_=Ln(_)}return!1}(f.target,["fixed","sticky"],g);return{x:f.clientX+(m?0:_),y:f.clientY+(m?0:v),target_fixed:m,type:p}}},{key:"_onClick",value:function(f){var p;if(!ys(f.target)){var v=this._getProperties(f,"click");null!==(p=this.rageclicks)&&void 0!==p&&p.isRageClick(f.clientX,f.clientY,(new Date).getTime())&&this._capture(t(t({},v),{},{type:"rageclick"})),this._capture(v)}}},{key:"_onMouseMove",value:function(f){var p=this;ys(f.target)||(clearTimeout(this._mouseMoveTimeout),this._mouseMoveTimeout=setTimeout((function(){p._capture(p._getProperties(f,"mousemove"))}),500))}},{key:"_capture",value:function(f){if(T){var p=T.location.href;this.buffer=this.buffer||{},this.buffer[p]||(this.buffer[p]=[]),this.buffer[p].push(f)}}},{key:"flush",value:function(){this.buffer&&!k(this.buffer)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}]),e}(),ks=function(){function e(f){var p=this;i(this,e),o(this,"_updateScrollData",(function(){var f,v,_,g;p.context||(p.context={});var m=p.scrollElement(),T=p.scrollY(),C=m?Math.max(0,m.scrollHeight-m.clientHeight):0,$=T+((null==m?void 0:m.clientHeight)||0),O=(null==m?void 0:m.scrollHeight)||0;p.context.lastScrollY=Math.ceil(T),p.context.maxScrollY=Math.max(T,null!==(f=p.context.maxScrollY)&&void 0!==f?f:0),p.context.maxScrollHeight=Math.max(C,null!==(v=p.context.maxScrollHeight)&&void 0!==v?v:0),p.context.lastContentY=$,p.context.maxContentY=Math.max($,null!==(_=p.context.maxContentY)&&void 0!==_?_:0),p.context.maxContentHeight=Math.max(O,null!==(g=p.context.maxContentHeight)&&void 0!==g?g:0)})),this.instance=f}return s(e,[{key:"getContext",value:function(){return this.context}},{key:"resetContext",value:function(){var f=this.context;return setTimeout(this._updateScrollData,0),f}},{key:"startMeasuringScrollPosition",value:function(){null==T||T.addEventListener("scroll",this._updateScrollData,!0),null==T||T.addEventListener("scrollend",this._updateScrollData,!0),null==T||T.addEventListener("resize",this._updateScrollData)}},{key:"scrollElement",value:function(){if(!this.instance.config.scroll_root_selector)return null==T?void 0:T.document.documentElement;var f,p=h(m(this.instance.config.scroll_root_selector)?this.instance.config.scroll_root_selector:[this.instance.config.scroll_root_selector]);try{for(p.s();!(f=p.n()).done;){var v=f.value,_=null==T?void 0:T.document.querySelector(v);if(_)return _}}catch(f){p.e(f)}finally{p.f()}}},{key:"scrollY",value:function(){if(this.instance.config.scroll_root_selector){var f=this.scrollElement();return f&&f.scrollTop||0}return T&&(T.scrollY||T.pageYOffset||T.document.documentElement.scrollTop)||0}},{key:"scrollX",value:function(){if(this.instance.config.scroll_root_selector){var f=this.scrollElement();return f&&f.scrollLeft||0}return T&&(T.scrollX||T.pageXOffset||T.document.documentElement.scrollLeft)||0}}]),e}(),ws="$copy_autocapture";function Ss(f,p){return p.length>f?p.slice(0,f)+"...":p}var Es,Fs=function(){function e(f){i(this,e),o(this,"_initialized",!1),o(this,"_isDisabledServerSide",null),o(this,"rageclicks",new ms),o(this,"_elementsChainAsString",!1),this.instance=f,this._elementSelectors=null}return s(e,[{key:"config",get:function(){var f,p,v=b(this.instance.config.autocapture)?this.instance.config.autocapture:{};return v.url_allowlist=null===(f=v.url_allowlist)||void 0===f?void 0:f.map((function(f){return new RegExp(f)})),v.url_ignorelist=null===(p=v.url_ignorelist)||void 0===p?void 0:p.map((function(f){return new RegExp(f)})),v}},{key:"_addDomEventHandlers",value:function(){var f=this;if(this.isBrowserSupported()){if(T&&D){var t=function(p){p=p||(null==T?void 0:T.event);try{f._captureEvent(p)}catch(f){W.error("Failed to capture event",f)}},n=function(p){p=p||(null==T?void 0:T.event),f._captureEvent(p,ws)};oe(D,"submit",t,!1,!0),oe(D,"change",t,!1,!0),oe(D,"click",t,!1,!0),this.config.capture_copied_text&&(oe(D,"copy",n,!1,!0),oe(D,"cut",n,!1,!0))}}else W.info("Disabling Automatic Event Collection because this browser is not supported")}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(this._addDomEventHandlers(),this._initialized=!0)}},{key:"afterDecideResponse",value:function(f){f.elementsChainAsString&&(this._elementsChainAsString=f.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register(o({},he,!!f.autocapture_opt_out)),this._isDisabledServerSide=!!f.autocapture_opt_out,this.startIfEnabled()}},{key:"setElementSelectors",value:function(f){this._elementSelectors=f}},{key:"getElementSelectors",value:function(f){var p,v=[];return null===(p=this._elementSelectors)||void 0===p||p.forEach((function(p){var _=null==D?void 0:D.querySelectorAll(p);null==_||_.forEach((function(_){f===_&&v.push(p)}))})),v}},{key:"isEnabled",get:function(){var f,p,v=null===(f=this.instance.persistence)||void 0===f?void 0:f.props[he],_=this._isDisabledServerSide;if(F(_)&&!x(v)&&!this.instance.config.advanced_disable_decide)return!1;var g=null!==(p=this._isDisabledServerSide)&&void 0!==p?p:!!v;return!!this.instance.config.autocapture&&!g}},{key:"_previousElementSibling",value:function(f){if(f.previousElementSibling)return f.previousElementSibling;var p=f;do{p=p.previousSibling}while(p&&!$n(p));return p}},{key:"_getAugmentPropertiesFromElement",value:function(f){if(!qn(f))return{};var p={};return Q(f.attributes,(function(f){if(f.name&&0===f.name.indexOf("data-ph-capture-attribute")){var v=f.name.replace("data-ph-capture-attribute-",""),_=f.value;v&&_&&Vn(_)&&(p[v]=_)}})),p}},{key:"_getPropertiesFromElement",value:function(f,p,v){var _,g=f.tagName.toLowerCase(),m={tag_name:g};Dn.indexOf(g)>-1&&!v&&("a"===g.toLowerCase()||"button"===g.toLowerCase()?m.$el_text=Ss(1024,Qn(f)):m.$el_text=Ss(1024,Cn(f)));var T=Pn(f);T.length>0&&(m.classes=T.filter((function(f){return""!==f})));var C=null===(_=this.config)||void 0===_?void 0:_.element_attribute_ignorelist;Q(f.attributes,(function(v){var _;if((!Bn(f)||-1!==["name","id","class","aria-label"].indexOf(v.name))&&(null==C||!C.includes(v.name))&&!p&&Vn(v.value)&&(_=v.name,!S(_)||"_ngcontent"!==_.substring(0,10)&&"_nghost"!==_.substring(0,7))){var g=v.value;"class"===v.name&&(g=Rn(g).join(" ")),m["attr__"+v.name]=Ss(1024,g)}}));for(var $=1,O=1,M=f;M=this._previousElementSibling(M);)$++,M.tagName===f.tagName&&O++;return m.nth_child=$,m.nth_of_type=O,m}},{key:"_getDefaultProperties",value:function(f){return{$event_type:f,$ce_version:1}}},{key:"_getEventTarget",value:function(f){return w(f.target)?f.srcElement||null:null!==(p=f.target)&&void 0!==p&&p.shadowRoot?f.composedPath()[0]||null:f.target||null;var p}},{key:"_captureEvent",value:function(f){var p=this,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$autocapture";if(this.isEnabled){var _,g=this._getEventTarget(f);(Mn(g)&&(g=g.parentNode||null),"$autocapture"===v&&"click"===f.type&&f instanceof MouseEvent)&&this.instance.config.rageclick&&null!==(_=this.rageclicks)&&void 0!==_&&_.isRageClick(f.clientX,f.clientY,(new Date).getTime())&&this._captureEvent(f,"$rageclick");var m=v===ws;if(g&&Nn(g,f,this.config,m,m?["copy","cut"]:void 0)){for(var C,$,O=[g],M=g;M.parentNode&&!On(M,"body");)An(M.parentNode)?(O.push(M.parentNode.host),M=M.parentNode.host):(O.push(M.parentNode),M=M.parentNode);var A,D,L=[],N={},q=!1;if(Q(O,(function(f){var v=qn(f);"a"===f.tagName.toLowerCase()&&(A=f.getAttribute("href"),A=v&&Vn(A)&&A),Y(Pn(f),"ph-no-capture")&&(q=!0),L.push(p._getPropertiesFromElement(f,p.instance.config.mask_all_element_attributes,p.instance.config.mask_all_text));var _=p._getAugmentPropertiesFromElement(f);J(N,_)})),this.instance.config.mask_all_text||("a"===g.tagName.toLowerCase()||"button"===g.tagName.toLowerCase()?L[0].$el_text=Qn(g):L[0].$el_text=Cn(g)),A){var B,H;L[0].attr__href=A;var U=null===(B=vt(A))||void 0===B?void 0:B.host,j=null==T||null===(H=T.location)||void 0===H?void 0:H.host;U&&j&&U!==j&&(D=A)}if(q)return!1;var W=J(this._getDefaultProperties(f.type),this._elementsChainAsString?{$elements_chain:Yn(L)}:{$elements:L},null!==(C=L[0])&&void 0!==C&&C.$el_text?{$el_text:null===($=L[0])||void 0===$?void 0:$.$el_text}:{},D&&"click"===f.type?{$external_click_url:D}:{},N),G=this.getElementSelectors(g);if(G&&G.length>0&&(W.$element_selectors=G),v===ws){var re,oe=Tn(null==T||null===(re=T.getSelection())||void 0===re?void 0:re.toString()),ue=f.type||"clipboard";if(!oe)return!1;W.$selected_content=oe,W.$copy_type=ue}return this.instance.capture(v,W),!0}}}},{key:"isBrowserSupported",value:function(){return y(null==D?void 0:D.querySelectorAll)}}]),e}(),Is=function(){function e(f){var p=this;i(this,e),o(this,"_restoreXHRPatch",void 0),o(this,"_restoreFetchPatch",void 0),o(this,"_startCapturing",(function(){w(p._restoreXHRPatch)&&U.postHogTracingHeadersPatchFns._patchXHR(p.instance.sessionManager),w(p._restoreFetchPatch)&&U.postHogTracingHeadersPatchFns._patchFetch(p.instance.sessionManager)})),this.instance=f}return s(e,[{key:"_loadScript",value:function(p){U.postHogTracingHeadersPatchFns&&p(),this.instance.requestRouter.loadScript("/static/tracing-headers.js?v=".concat(f.LIB_VERSION),(function(f){f&&W.error("[TRACING-HEADERS] failed to load script",f),p()}))}},{key:"startIfEnabledOrStop",value:function(){var f,p;this.instance.config.__add_tracing_headers?this._loadScript(this._startCapturing):(null===(f=this._restoreXHRPatch)||void 0===f||f.call(this),null===(p=this._restoreFetchPatch)||void 0===p||p.call(this),this._restoreXHRPatch=void 0,this._restoreFetchPatch=void 0)}}]),e}();!function(f){f[f.PENDING=-1]="PENDING",f[f.DENIED=0]="DENIED",f[f.GRANTED=1]="GRANTED"}(Es||(Es={}));var Rs=function(){function e(f){i(this,e),this.instance=f}return s(e,[{key:"config",get:function(){return this.instance.config}},{key:"consent",get:function(){return this.getDnt()?Es.DENIED:this.storedConsent}},{key:"isOptedOut",value:function(){return this.consent===Es.DENIED||this.consent===Es.PENDING&&this.config.opt_out_capturing_by_default}},{key:"isOptedIn",value:function(){return!this.isOptedOut()}},{key:"optInOut",value:function(f){this.storage.set(this.storageKey,f?1:0,this.config.cookie_expiration,this.config.cross_subdomain_cookie,this.config.secure_cookie)}},{key:"reset",value:function(){this.storage.remove(this.storageKey,this.config.cross_subdomain_cookie)}},{key:"storageKey",get:function(){var f=this.instance.config,p=f.token;return(f.opt_out_capturing_cookie_prefix||"__ph_opt_in_out_")+p}},{key:"storedConsent",get:function(){var f=this.storage.get(this.storageKey);return"1"===f?Es.GRANTED:"0"===f?Es.DENIED:Es.PENDING}},{key:"storage",get:function(){if(!this._storage){var f=this.config.opt_out_capturing_persistence_type;this._storage="localStorage"===f?at:st;var p="localStorage"===f?st:at;p.get(this.storageKey)&&(this._storage.get(this.storageKey)||this.optInOut("1"===p.get(this.storageKey)),p.remove(this.storageKey,this.config.cross_subdomain_cookie))}return this._storage}},{key:"getDnt",value:function(){return!!this.config.respect_dnt&&!!ae([null==A?void 0:A.doNotTrack,null==A?void 0:A.msDoNotTrack,U.doNotTrack],(function(f){return Y([!0,1,"1","yes"],f)}))}}]),e}(),xs="[Web Vitals]",Ps=function(){function e(f){var p,v=this;i(this,e),o(this,"_enabledServerSide",!1),o(this,"_initialized",!1),o(this,"buffer",{url:void 0,metrics:[],firstMetricTimestamp:void 0}),o(this,"_flushToCapture",(function(){clearTimeout(v._delayedFlushTimer),0!==v.buffer.metrics.length&&(v.instance.capture("$web_vitals",v.buffer.metrics.reduce((function(f,p){var v;return t(t({},f),{},(o(v={},"$web_vitals_".concat(p.name,"_event"),t({},p)),o(v,"$web_vitals_".concat(p.name,"_value"),p.value),v))}),{})),v.buffer={url:void 0,metrics:[],firstMetricTimestamp:void 0})})),o(this,"_addToBuffer",(function(f){var p,_=null===(p=v.instance.sessionManager)||void 0===p?void 0:p.checkAndGetSessionAndWindowId(!0);if(w(_))W.error(xs+"Could not read session ID. Dropping metrics!");else{v.buffer=v.buffer||{};var g=v._currentURL();w(g)||(I(null==f?void 0:f.name)||I(null==f?void 0:f.value)?W.error(xs+"Invalid metric received",f):(v.buffer.url!==g&&(v._flushToCapture(),v._delayedFlushTimer=setTimeout(v._flushToCapture,8e3)),w(v.buffer.url)&&(v.buffer.url=g),v.buffer.firstMetricTimestamp=w(v.buffer.firstMetricTimestamp)?Date.now():v.buffer.firstMetricTimestamp,v.buffer.metrics.push(t(t({},f),{},{$current_url:g,$session_id:_.sessionId,$window_id:_.windowId,timestamp:Date.now()})),4===v.buffer.metrics.length&&v._flushToCapture()))}})),o(this,"_startCapturing",(function(){var f=U.postHogWebVitalsCallbacks,p=f.onLCP,_=f.onCLS,g=f.onFCP,m=f.onINP;p(v._addToBuffer),_(v._addToBuffer),g(v._addToBuffer),m(v._addToBuffer),v._initialized=!0})),this.instance=f,this._enabledServerSide=!(null===(p=this.instance.persistence)||void 0===p||!p.props[_e]),this.startIfEnabled()}return s(e,[{key:"isEnabled",get:function(){var f=b(this.instance.config.capture_performance)?this.instance.config.capture_performance.web_vitals:void 0;return x(f)?f:this._enabledServerSide}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(W.info(xs+" enabled, starting..."),this.loadScript(this._startCapturing))}},{key:"afterDecideResponse",value:function(f){var p=b(f.capturePerformance)&&!!f.capturePerformance.web_vitals;this.instance.persistence&&this.instance.persistence.register(o({},_e,p)),this._enabledServerSide=p,this.startIfEnabled()}},{key:"loadScript",value:function(p){T.postHogWebVitalsCallbacks&&p(),this.instance.requestRouter.loadScript(this.instance.requestRouter.endpointFor("assets","/static/web-vitals.js?v=".concat(f.LIB_VERSION)),(function(f){f&&W.error(xs+" failed to load script",f),p()}))}},{key:"_currentURL",value:function(){var f=T?T.location.href:void 0;return f||W.error(xs+"Could not determine current URL"),f}}]),e}(),Ts={},Cs=function(){},$s="posthog",Os=!tr&&-1===(null==H?void 0:H.indexOf("MSIE"))&&-1===(null==H?void 0:H.indexOf("Mozilla")),Ms=function(){var f,p,v;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:(p=null==D?void 0:D.location,v=null==p?void 0:p.hostname,!!S(v)&&"herokuapp.com"!==v.split(".").slice(-2).join(".")),persistence:"localStorage+cookie",persistence_name:"",loaded:Cs,store_google:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:L&&S(null==L?void 0:L.search)&&-1!==L.search.indexOf("__posthog_debug=true")||!1,verbose:!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_surveys:!1,enable_recording_console_log:void 0,secure_cookie:"https:"===(null==T||null===(f=T.location)||void 0===f?void 0:f.protocol),ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},inapp_protocol:"//",inapp_link_new_window:!1,request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,on_request_error:function(f){var p="Bad HTTP status: "+f.statusCode+" "+f.text;W.error(p)},get_device_id:function(f){return f},_onCapture:Cs,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"always",__add_tracing_headers:!1}},As=function(f){var p={};w(f.process_person)||(p.person_profiles=f.process_person),w(f.xhr_headers)||(p.request_headers=f.xhr_headers),w(f.cookie_name)||(p.persistence_name=f.cookie_name),w(f.disable_cookie)||(p.disable_persistence=f.disable_cookie);var v=J({},p,f);return m(f.property_blacklist)&&(w(f.property_denylist)?v.property_denylist=f.property_blacklist:m(f.property_denylist)?v.property_denylist=[].concat(l(f.property_blacklist),l(f.property_denylist)):W.error("Invalid value for property_denylist config: "+f.property_denylist)),v},Ds=function(){function e(){i(this,e),o(this,"__forceAllowLocalhost",!1)}return s(e,[{key:"_forceAllowLocalhost",get:function(){return this.__forceAllowLocalhost},set:function(f){W.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=f}}]),e}(),Ls=function(){function e(){var f=this;i(this,e),o(this,"webPerformance",new Ds),o(this,"_internalEventEmitter",new Ir),this.config=Ms(),this.decideEndpointWasHit=!1,this.SentryIntegration=yr,this.sentryIntegration=function(p){return function(f,p){var v=mr(f,p);return{name:gr,processEvent:function(f){return v(f)}}}(f,p)},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this.featureFlags=new Ge(this),this.toolbar=new mi(this),this.scrollManager=new ks(this),this.pageViewManager=new Er(this),this.surveys=new hs(this),this.rateLimiter=new fs(this),this.requestRouter=new fr(this),this.consent=new Rs(this),this.people={set:function(p,v,_){var g=S(p)?o({},p,v):p;f.setPersonProperties(g),null==_||_({})},set_once:function(p,v,_){var g=S(p)?o({},p,v):p;f.setPersonProperties(void 0,g),null==_||_({})}},this.on("eventCaptured",(function(f){return W.info("send",f)}))}return s(e,[{key:"init",value:function(f,p,v){if(v&&v!==$s){var _,g=null!==(_=Ts[v])&&void 0!==_?_:new e;return g._init(f,p,v),Ts[v]=g,Ts[$s][v]=g,g}return this._init(f,p,v)}},{key:"_init",value:function(p){var v,_,g=this,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},C=arguments.length>2?arguments[2]:void 0;if(w(p)||E(p))return W.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return W.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;if(this.__loaded=!0,this.config={},this._triggered_notifs=[],this.set_config(J({},Ms(),As(m),{name:C,token:p})),this.config.on_xhr_error&&W.error("[posthog] on_xhr_error is deprecated. Use on_request_error instead"),this.compression=m.disable_compression?void 0:re.Base64,this.persistence=new bn(this.config),this.sessionPersistence="sessionStorage"===this.config.persistence?this.persistence:new bn(t(t({},this.config),{},{persistence:"sessionStorage"})),this._requestQueue=new yi((function(f){return g._send_retriable_request(f)})),this._retryQueue=new lr(this),this.__request_queue=[],this.sessionManager=new dr(this.config,this.persistence),this.sessionPropsManager=new vs(this.sessionManager,this.persistence),new Is(this).startIfEnabledOrStop(),this.sessionRecording=new pi(this),this.sessionRecording.startIfEnabledOrStop(),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new Fs(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new bs(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new Ps(this),this.exceptionObserver=new _r(this),this.exceptionObserver.startIfEnabled(),f.DEBUG=f.DEBUG||this.config.debug,this._sync_opt_out_with_persistence(),void 0!==(null===(v=m.bootstrap)||void 0===v?void 0:v.distinctID)){var $,O,M=this.config.get_device_id(Ke()),A=null!==($=m.bootstrap)&&void 0!==$&&$.isIdentifiedID?M:m.bootstrap.distinctID;this.persistence.set_property($e,null!==(O=m.bootstrap)&&void 0!==O&&O.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:m.bootstrap.distinctID,$device_id:A})}if(this._hasBootstrappedFeatureFlags()){var D,L,N=Object.keys((null===(D=m.bootstrap)||void 0===D?void 0:D.featureFlags)||{}).filter((function(f){var p,v;return!(null===(p=m.bootstrap)||void 0===p||null===(v=p.featureFlags)||void 0===v||!v[f])})).reduce((function(f,p){var v,_;return f[p]=(null===(v=m.bootstrap)||void 0===v||null===(_=v.featureFlags)||void 0===_?void 0:_[p])||!1,f}),{}),q=Object.keys((null===(L=m.bootstrap)||void 0===L?void 0:L.featureFlagPayloads)||{}).filter((function(f){return N[f]})).reduce((function(f,p){var v,_,g,T;null!==(v=m.bootstrap)&&void 0!==v&&null!==(_=v.featureFlagPayloads)&&void 0!==_&&_[p]&&(f[p]=null===(g=m.bootstrap)||void 0===g||null===(T=g.featureFlagPayloads)||void 0===T?void 0:T[p]);return f}),{});this.featureFlags.receivedFeatureFlags({featureFlags:N,featureFlagPayloads:q})}if(!this.get_distinct_id()){var B=this.config.get_device_id(Ke());this.register_once({distinct_id:B,$device_id:B},""),this.persistence.set_property($e,"anonymous")}return null==T||null===(_=T.addEventListener)||void 0===_||_.call(T,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this)),this.toolbar.maybeLoadToolbar(),m.segment?br(this,(function(){return g._loaded()})):this._loaded(),y(this.config._onCapture)&&this.on("eventCaptured",(function(f){return g.config._onCapture(f.event,f)})),this}},{key:"_afterDecideResponse",value:function(f){var p,v,_,g,m,T,C;this.compression=void 0,f.supportedCompression&&!this.config.disable_compression&&(this.compression=Y(f.supportedCompression,re.GZipJS)?re.GZipJS:Y(f.supportedCompression,re.Base64)?re.Base64:void 0),null!==(p=f.analytics)&&void 0!==p&&p.endpoint&&(this.analyticsDefaultEndpoint=f.analytics.endpoint),null===(v=this.sessionRecording)||void 0===v||v.afterDecideResponse(f),null===(_=this.autocapture)||void 0===_||_.afterDecideResponse(f),null===(g=this.heatmaps)||void 0===g||g.afterDecideResponse(f),null===(m=this.surveys)||void 0===m||m.afterDecideResponse(f),null===(T=this.webVitalsAutocapture)||void 0===T||T.afterDecideResponse(f),null===(C=this.exceptionObserver)||void 0===C||C.afterDecideResponse(f)}},{key:"_loaded",value:function(){var f=this,p=this.config.advanced_disable_decide;p||this.featureFlags.setReloadingPaused(!0);try{this.config.loaded(this)}catch(f){W.critical("`loaded` function failed",f)}this._start_queue_if_opted_in(),this.config.capture_pageview&&setTimeout((function(){D&&f.capture("$pageview",{title:D.title},{send_instantly:!0})}),1),p||(new vi(this).call(),this.featureFlags.resetRequestQueue())}},{key:"_start_queue_if_opted_in",value:function(){var f;this.has_opted_out_capturing()||this.config.request_batching&&(null===(f=this._requestQueue)||void 0===f||f.enable())}},{key:"_dom_loaded",value:function(){var f=this;this.has_opted_out_capturing()||V(this.__request_queue,(function(p){return f._send_retriable_request(p)})),this.__request_queue=[],this._start_queue_if_opted_in()}},{key:"_handle_unload",value:function(){var f,p;this.config.request_batching?(this._shouldCapturePageleave()&&this.capture("$pageleave"),null===(f=this._requestQueue)||void 0===f||f.unload(),null===(p=this._retryQueue)||void 0===p||p.unload()):this._shouldCapturePageleave()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}},{key:"_send_request",value:function(p){var v=this;this.__loaded&&(Os?this.__request_queue.push(p):this.rateLimiter.isServerRateLimited(p.batchKey)||(p.transport=p.transport||this.config.api_transport,p.url=ir(p.url,{ip:this.config.ip?1:0}),p.headers=this.config.request_headers,p.compression="best-available"===p.compression?this.compression:p.compression,function(p){var v,_,g,m=t({},p);m.timeout=m.timeout||6e4,m.url=ir(m.url,{_:(new Date).getTime().toString(),ver:f.LIB_VERSION,compression:m.compression});var T=null!==(v=m.transport)&&void 0!==v?v:"XHR",C=null!==(_=null===(g=ae(or,(function(f){return f.transport===T})))||void 0===g?void 0:g.method)&&void 0!==_?_:or[0].method;if(!C)throw new Error("No available transport method");C(m)}(t(t({},p),{},{callback:function(f){var _,g,m;(v.rateLimiter.checkForLimiting(f),f.statusCode>=400)&&(null===(g=(m=v.config).on_request_error)||void 0===g||g.call(m,f));null===(_=p.callback)||void 0===_||_.call(p,f)}}))))}},{key:"_send_retriable_request",value:function(f){this._retryQueue?this._retryQueue.retriableRequest(f):this._send_request(f)}},{key:"_execute_array",value:function(f){var p,v=this,_=[],g=[],T=[];V(f,(function(f){f&&(p=f[0],m(p)?T.push(f):y(f)?f.call(v):m(f)&&"alias"===p?_.push(f):m(f)&&-1!==p.indexOf("capture")&&y(v[p])?T.push(f):g.push(f))}));var o=function(f,p){V(f,(function(f){if(m(f[0])){var v=p;Q(f,(function(f){v=v[f[0]].apply(v,f.slice(1))}))}else this[f[0]].apply(this,f.slice(1))}),p)};o(_,this),o(g,this),o(T,this)}},{key:"_hasBootstrappedFeatureFlags",value:function(){var f,p;return(null===(f=this.config.bootstrap)||void 0===f?void 0:f.featureFlags)&&Object.keys(null===(p=this.config.bootstrap)||void 0===p?void 0:p.featureFlags).length>0||!1}},{key:"push",value:function(f){this._execute_array([f])}},{key:"capture",value:function(f,p,v){var _;if(!(this.__loaded&&this.persistence&&this.sessionPersistence&&this._requestQueue))return W.uninitializedWarning("posthog.capture");if(!this.consent.isOptedOut())if(!w(f)&&S(f)){if(!H||this.config.opt_out_useragent_filter||!gs(H,this.config.custom_blocked_useragents)){var g=null!=v&&v.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(null==g||!g.isRateLimited){this.sessionPersistence.update_search_keyword(),this.config.store_google&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.store_google||this.config.save_referrer)&&this.persistence.set_initial_person_info();var m={uuid:Ke(),event:f,properties:this._calculate_event_properties(f,p||{})};g&&(m.properties.$lib_rate_limit_remaining_tokens=g.remainingTokens),(null==v?void 0:v.$set)&&(m.$set=null==v?void 0:v.$set);var T=this._calculate_set_once_properties(null==v?void 0:v.$set_once);T&&(m.$set_once=T),(m=ie(m,null!=v&&v._noTruncate?null:this.config.properties_string_max_length)).timestamp=(null==v?void 0:v.timestamp)||new Date,w(null==v?void 0:v.timestamp)||(m.properties.$event_time_override_provided=!0,m.properties.$event_time_override_system_time=new Date);var C=t(t({},m.properties.$set),m.$set);k(C)||this.setPersonPropertiesForFlags(C),this._internalEventEmitter.emit("eventCaptured",m);var $={method:"POST",url:null!==(_=null==v?void 0:v._url)&&void 0!==_?_:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:m,compression:"best-available",batchKey:null==v?void 0:v._batchKey};return!this.config.request_batching||v&&(null==v||!v._batchKey)||null!=v&&v.send_instantly?this._send_retriable_request($):this._requestQueue.enqueue($),m}W.critical("This capture call is ignored due to client rate limiting.")}}else W.error("No event name provided to posthog.capture")}},{key:"_addCaptureHook",value:function(f){this.on("eventCaptured",(function(p){return f(p.event,p)}))}},{key:"_calculate_event_properties",value:function(f,p){if(!this.persistence||!this.sessionPersistence)return p;var v=this.persistence.remove_event_timer(f),_=t({},p);if(_.token=this.config.token,"$snapshot"===f){var g=t(t({},this.persistence.properties()),this.sessionPersistence.properties());return _.distinct_id=g.distinct_id,(!S(_.distinct_id)&&!R(_.distinct_id)||E(_.distinct_id))&&W.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),_}var T=mn.properties();if(this.sessionManager){var C=this.sessionManager.checkAndGetSessionAndWindowId(),$=C.sessionId,O=C.windowId;_.$session_id=$,_.$window_id=O}if(this.requestRouter.region===ur.CUSTOM&&(_.$lib_custom_api_host=this.config.api_host),this.sessionPropsManager&&this.config.__preview_send_client_session_params&&("$pageview"===f||"$pageleave"===f||"$autocapture"===f)){var M=this.sessionPropsManager.getSessionProps();_=J(_,M)}if(!this.config.disable_scroll_properties){var A={};"$pageview"===f?A=this.pageViewManager.doPageView():"$pageleave"===f&&(A=this.pageViewManager.doPageLeave()),_=J(_,A)}if("$pageview"===f&&D&&(_.title=D.title),!w(v)){var L=(new Date).getTime()-v;_.$duration=parseFloat((L/1e3).toFixed(3))}H&&this.config.opt_out_useragent_filter&&(_.$browser_type=gs(H,this.config.custom_blocked_useragents)?"bot":"browser"),(_=J({},T,this.persistence.properties(),this.sessionPersistence.properties(),_)).$is_identified=this._isIdentified(),m(this.config.property_denylist)?Q(this.config.property_denylist,(function(f){delete _[f]})):W.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var N=this.config.sanitize_properties;return N&&(_=N(_,f)),_.$process_person_profile=this._hasPersonProcessing(),_}},{key:"_calculate_set_once_properties",value:function(f){if(!this.persistence||!this._hasPersonProcessing())return f;var p=J({},this.persistence.get_initial_props(),f||{});return k(p)?void 0:p}},{key:"register",value:function(f,p){var v;null===(v=this.persistence)||void 0===v||v.register(f,p)}},{key:"register_once",value:function(f,p,v){var _;null===(_=this.persistence)||void 0===_||_.register_once(f,p,v)}},{key:"register_for_session",value:function(f){var p;null===(p=this.sessionPersistence)||void 0===p||p.register(f)}},{key:"unregister",value:function(f){var p;null===(p=this.persistence)||void 0===p||p.unregister(f)}},{key:"unregister_for_session",value:function(f){var p;null===(p=this.sessionPersistence)||void 0===p||p.unregister(f)}},{key:"_register_single",value:function(f,p){this.register(o({},f,p))}},{key:"getFeatureFlag",value:function(f,p){return this.featureFlags.getFeatureFlag(f,p)}},{key:"getFeatureFlagPayload",value:function(f){var p=this.featureFlags.getFeatureFlagPayload(f);try{return JSON.parse(p)}catch(f){return p}}},{key:"isFeatureEnabled",value:function(f,p){return this.featureFlags.isFeatureEnabled(f,p)}},{key:"reloadFeatureFlags",value:function(){this.featureFlags.reloadFeatureFlags()}},{key:"updateEarlyAccessFeatureEnrollment",value:function(f,p){this.featureFlags.updateEarlyAccessFeatureEnrollment(f,p)}},{key:"getEarlyAccessFeatures",value:function(f){var p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.featureFlags.getEarlyAccessFeatures(f,p)}},{key:"on",value:function(f,p){return this._internalEventEmitter.on(f,p)}},{key:"onFeatureFlags",value:function(f){return this.featureFlags.onFeatureFlags(f)}},{key:"onSessionId",value:function(f){var p,v;return null!==(p=null===(v=this.sessionManager)||void 0===v?void 0:v.onSessionId(f))&&void 0!==p?p:function(){}}},{key:"getSurveys",value:function(f){var p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.surveys.getSurveys(f,p)}},{key:"getActiveMatchingSurveys",value:function(f){var p=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.surveys.getActiveMatchingSurveys(f,p)}},{key:"getNextSurveyStep",value:function(f,p,v){return this.surveys.getNextSurveyStep(f,p,v)}},{key:"identify",value:function(f,p,v){if(!this.__loaded||!this.persistence)return W.uninitializedWarning("posthog.identify");if(R(f)&&(f=f.toString(),W.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),f){if(["distinct_id","distinctid"].includes(f.toLowerCase()))W.critical('The string "'.concat(f,'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.'));else if(this._requirePersonProcessing("posthog.identify")){var _=this.get_distinct_id();if(this.register({$user_id:f}),!this.get_property("$device_id")){var g=_;this.register_once({$had_persisted_distinct_id:!0,$device_id:g},"")}f!==_&&f!==this.get_property(ce)&&(this.unregister(ce),this.register({distinct_id:f}));var m="anonymous"===(this.persistence.get_property($e)||"anonymous");f!==_&&m?(this.persistence.set_property($e,"identified"),this.setPersonPropertiesForFlags(p||{},!1),this.capture("$identify",{distinct_id:f,$anon_distinct_id:_},{$set:p||{},$set_once:v||{}}),this.featureFlags.setAnonymousDistinctId(_)):(p||v)&&this.setPersonProperties(p,v),f!==_&&(this.reloadFeatureFlags(),this.unregister(Ce))}}else W.error("Unique user id has not been set in posthog.identify")}},{key:"setPersonProperties",value:function(f,p){(f||p)&&this._requirePersonProcessing("posthog.setPersonProperties")&&(this.setPersonPropertiesForFlags(f||{}),this.capture("$set",{$set:f||{},$set_once:p||{}}))}},{key:"group",value:function(f,p,v){if(f&&p){if(this._requirePersonProcessing("posthog.group")){var _=this.getGroups();_[f]!==p&&this.resetGroupPropertiesForFlags(f),this.register({$groups:t(t({},_),{},o({},f,p))}),v&&(this.capture("$groupidentify",{$group_type:f,$group_key:p,$group_set:v}),this.setGroupPropertiesForFlags(o({},f,v))),_[f]===p||v||this.reloadFeatureFlags()}}else W.error("posthog.group requires a group type and group key")}},{key:"resetGroups",value:function(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}},{key:"setPersonPropertiesForFlags",value:function(f){var p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._requirePersonProcessing("posthog.setPersonPropertiesForFlags")&&this.featureFlags.setPersonPropertiesForFlags(f,p)}},{key:"resetPersonPropertiesForFlags",value:function(){this.featureFlags.resetPersonPropertiesForFlags()}},{key:"setGroupPropertiesForFlags",value:function(f){var p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._requirePersonProcessing("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(f,p)}},{key:"resetGroupPropertiesForFlags",value:function(f){this.featureFlags.resetGroupPropertiesForFlags(f)}},{key:"reset",value:function(f){var p,v,_,g;if(!this.__loaded)return W.uninitializedWarning("posthog.reset");var m=this.get_property("$device_id");this.consent.reset(),null===(p=this.persistence)||void 0===p||p.clear(),null===(v=this.sessionPersistence)||void 0===v||v.clear(),null===(_=this.persistence)||void 0===_||_.set_property($e,"anonymous"),null===(g=this.sessionManager)||void 0===g||g.resetSessionId();var T=this.config.get_device_id(Ke());this.register_once({distinct_id:T,$device_id:f?T:m},"")}},{key:"get_distinct_id",value:function(){return this.get_property("distinct_id")}},{key:"getGroups",value:function(){return this.get_property("$groups")||{}}},{key:"get_session_id",value:function(){var f,p;return null!==(f=null===(p=this.sessionManager)||void 0===p?void 0:p.checkAndGetSessionAndWindowId(!0).sessionId)&&void 0!==f?f:""}},{key:"get_session_replay_url",value:function(f){if(!this.sessionManager)return"";var p=this.sessionManager.checkAndGetSessionAndWindowId(!0),v=p.sessionId,_=p.sessionStartTimestamp,g=this.requestRouter.endpointFor("ui","/project/".concat(this.config.token,"/replay/").concat(v));if(null!=f&&f.withTimestamp&&_){var m,T=null!==(m=f.timestampLookBack)&&void 0!==m?m:10;if(!_)return g;var C=Math.max(Math.floor(((new Date).getTime()-_)/1e3)-T,0);g+="?t=".concat(C)}return g}},{key:"alias",value:function(f,p){return f===this.get_property(le)?(W.critical("Attempting to create alias for existing People user - aborting."),-2):this._requirePersonProcessing("posthog.alias")?(w(p)&&(p=this.get_distinct_id()),f!==p?(this._register_single(ce,f),this.capture("$create_alias",{alias:f,distinct_id:p})):(W.warn("alias matches current distinct_id - skipping api call."),this.identify(f),-1)):void 0}},{key:"set_config",value:function(p){var v,_,g,m,T=t({},this.config);b(p)&&(J(this.config,As(p)),null===(v=this.persistence)||void 0===v||v.update_config(this.config,T),this.sessionPersistence="sessionStorage"===this.config.persistence?this.persistence:new bn(t(t({},this.config),{},{persistence:"sessionStorage"})),at.is_supported()&&"true"===at.get("ph_debug")&&(this.config.debug=!0),this.config.debug&&(f.DEBUG=!0),null===(_=this.sessionRecording)||void 0===_||_.startIfEnabledOrStop(),null===(g=this.autocapture)||void 0===g||g.startIfEnabled(),null===(m=this.heatmaps)||void 0===m||m.startIfEnabled(),this.surveys.loadIfEnabled(),this._sync_opt_out_with_persistence())}},{key:"startSessionRecording",value:function(f){if(null!=f&&f.sampling){var p,v,_=null===(p=this.sessionManager)||void 0===p?void 0:p.checkAndGetSessionAndWindowId();null===(v=this.persistence)||void 0===v||v.register(o({},Ee,!0)),W.info("Session recording started with sampling override for session: ",null==_?void 0:_.sessionId)}this.set_config({disable_session_recording:!1})}},{key:"stopSessionRecording",value:function(){this.set_config({disable_session_recording:!0})}},{key:"sessionRecordingStarted",value:function(){var f;return!(null===(f=this.sessionRecording)||void 0===f||!f.started)}},{key:"loadToolbar",value:function(f){return this.toolbar.loadToolbar(f)}},{key:"get_property",value:function(f){var p;return null===(p=this.persistence)||void 0===p?void 0:p.props[f]}},{key:"getSessionProperty",value:function(f){var p;return null===(p=this.sessionPersistence)||void 0===p?void 0:p.props[f]}},{key:"toString",value:function(){var f,p=null!==(f=this.config.name)&&void 0!==f?f:$s;return p!==$s&&(p=$s+"."+p),p}},{key:"_isIdentified",value:function(){var f,p;return"identified"===(null===(f=this.persistence)||void 0===f?void 0:f.get_property($e))||"identified"===(null===(p=this.sessionPersistence)||void 0===p?void 0:p.get_property($e))}},{key:"_hasPersonProcessing",value:function(){var f,p,v,_;return!("never"===this.config.person_profiles||"identified_only"===this.config.person_profiles&&!this._isIdentified()&&k(this.getGroups())&&(null===(f=this.persistence)||void 0===f||null===(p=f.props)||void 0===p||!p[ce])&&(null===(v=this.persistence)||void 0===v||null===(_=v.props)||void 0===_||!_[Ne]))}},{key:"_shouldCapturePageleave",value:function(){return!0===this.config.capture_pageleave||"if_capture_pageview"===this.config.capture_pageleave&&this.config.capture_pageview}},{key:"createPersonProfile",value:function(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.setPersonProperties({},{})}},{key:"_requirePersonProcessing",value:function(f){return"never"===this.config.person_profiles?(W.error(f+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._register_single(Ne,!0),!0)}},{key:"_sync_opt_out_with_persistence",value:function(){var f,p,v,_,g=this.consent.isOptedOut(),m=this.config.opt_out_persistence_by_default,T=this.config.disable_persistence||g&&!!m;(null===(f=this.persistence)||void 0===f?void 0:f.disabled)!==T&&(null===(v=this.persistence)||void 0===v||v.set_disabled(T));(null===(p=this.sessionPersistence)||void 0===p?void 0:p.disabled)!==T&&(null===(_=this.sessionPersistence)||void 0===_||_.set_disabled(T))}},{key:"opt_in_capturing",value:function(f){var p;this.consent.optInOut(!0),this._sync_opt_out_with_persistence(),(w(null==f?void 0:f.captureEventName)||null!=f&&f.captureEventName)&&this.capture(null!==(p=null==f?void 0:f.captureEventName)&&void 0!==p?p:"$opt_in",null==f?void 0:f.captureProperties,{send_instantly:!0})}},{key:"opt_out_capturing",value:function(){this.consent.optInOut(!1),this._sync_opt_out_with_persistence()}},{key:"has_opted_in_capturing",value:function(){return this.consent.isOptedIn()}},{key:"has_opted_out_capturing",value:function(){return this.consent.isOptedOut()}},{key:"clear_opt_in_out_capturing",value:function(){this.consent.reset(),this._sync_opt_out_with_persistence()}},{key:"debug",value:function(f){!1===f?(null==T||T.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(null==T||T.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}}]),e}();!function(f,p){for(var v=0;v<p.length;v++)f.prototype[p[v]]=ee(f.prototype[p[v]])}(Ls,["identify"]);var Ns,qs=(Ns=Ts[$s]=new Ls,function(){function e(){e.done||(e.done=!0,Os=!1,Q(Ts,(function(f){f._dom_loaded()})))}null!=D&&D.addEventListener&&("complete"===D.readyState?e():D.addEventListener("DOMContentLoaded",e,!1)),T&&oe(T,"load",e,!0)}(),Ns);export{re as Compression,Ls as PostHog,Sr as SurveyQuestionBranchingType,wr as SurveyQuestionType,kr as SurveyType,qs as default,qs as posthog,ue as severityLevels};

